<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIA Health Plan Comparator & Premium Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f8fafc; }
        .sticky-col { position: sticky; left: 0; z-index: 20; background-color: white; }
        .sticky-header { position: sticky; top: 0; z-index: 30; }
        .premium-highlight { background-color: #f0fdf4; border: 2px solid #22c55e; color: #15803d; font-weight: bold; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="text-slate-800">

    <div class="max-w-[1600px] mx-auto bg-white shadow-2xl border-x border-gray-200 min-h-screen flex flex-col">
        
        <!-- Header & Calculator Section -->
        <div class="bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 text-white p-6 shadow-lg sticky-header">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                
                <!-- Title -->
                <div>
                    <h1 class="text-2xl font-bold flex items-center gap-2">
                        <i data-lucide="calculator" class="text-teal-400"></i>
                        เปรียบเทียบและคำนวณเบี้ยประกันสุขภาพ
                    </h1>
                    <p class="text-slate-300 text-sm mt-1 opacity-90">ข้อมูลอ้างอิง: Rider Rate 2025 & Compare Excel Rev004</p>
                </div>

                <!-- Input Form -->
                <div class="bg-white/10 p-4 rounded-xl border border-white/20 backdrop-blur-sm flex flex-wrap gap-4 items-end w-full lg:w-auto">
                    <div>
                        <label class="block text-xs text-slate-300 mb-1">เพศ (Gender)</label>
                        <select id="input-gender" class="bg-slate-800 border border-slate-600 text-white text-sm rounded px-3 py-2 w-32 focus:ring-2 focus:ring-teal-500 outline-none">
                            <option value="male">ชาย (Male)</option>
                            <option value="female">หญิง (Female)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs text-slate-300 mb-1">อายุ (Age)</label>
                        <input type="number" id="input-age" value="35" min="0" max="75" class="bg-slate-800 border border-slate-600 text-white text-sm rounded px-3 py-2 w-24 focus:ring-2 focus:ring-teal-500 outline-none">
                    </div>
                    <button onclick="calculateAll()" class="bg-teal-500 hover:bg-teal-600 text-white text-sm font-bold py-2 px-6 rounded shadow-lg transition-all transform hover:scale-105 flex items-center gap-2">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i> คำนวณเบี้ย
                    </button>
                </div>
            </div>
        </div>

        <!-- Controls (Plan Selectors) -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-slate-50 border-b border-gray-200">
            <!-- Plan 1 -->
            <div class="bg-white p-3 rounded-lg border border-emerald-200 shadow-sm">
                <div class="text-xs font-bold text-emerald-700 uppercase mb-1">Plan A (ซ้าย)</div>
                <select id="sel-type-1" class="w-full text-sm font-bold border-gray-300 rounded mb-2 text-slate-700" onchange="updatePlan(1, this.value, 0)"></select>
                <select id="sel-opt-1" class="w-full text-sm border-gray-300 rounded text-slate-600" onchange="updatePlanIdx(1, this.value)"></select>
            </div>
            <!-- Plan 2 -->
            <div class="bg-white p-3 rounded-lg border border-sky-200 shadow-sm">
                <div class="text-xs font-bold text-sky-700 uppercase mb-1">Plan B (กลาง)</div>
                <select id="sel-type-2" class="w-full text-sm font-bold border-gray-300 rounded mb-2 text-slate-700" onchange="updatePlan(2, this.value, 0)"></select>
                <select id="sel-opt-2" class="w-full text-sm border-gray-300 rounded text-slate-600" onchange="updatePlanIdx(2, this.value)"></select>
            </div>
            <!-- Plan 3 -->
            <div class="bg-white p-3 rounded-lg border border-pink-200 shadow-sm hidden md:block">
                <div class="text-xs font-bold text-pink-700 uppercase mb-1">Plan C (ขวา)</div>
                <select id="sel-type-3" class="w-full text-sm font-bold border-gray-300 rounded mb-2 text-slate-700" onchange="updatePlan(3, this.value, 0)"></select>
                <select id="sel-opt-3" class="w-full text-sm border-gray-300 rounded text-slate-600" onchange="updatePlanIdx(3, this.value)"></select>
            </div>
        </div>

        <!-- Main Table -->
        <div class="overflow-x-auto flex-grow">
            <table class="w-full min-w-[1200px] border-collapse text-sm">
                <thead>
                    <tr class="bg-slate-50">
                        <th class="p-4 w-[25%] text-left sticky-col border-r border-gray-200 z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">
                            รายการความคุ้มครอง
                        </th>
                        <th id="th-1" class="p-4 w-[25%] align-top border-b-4 transition-all"></th>
                        <th id="th-2" class="p-4 w-[25%] align-top border-b-4 transition-all"></th>
                        <th id="th-3" class="p-4 w-[25%] align-top border-b-4 transition-all hidden md:table-cell"></th>
                    </tr>
                    <!-- Premium Row (Sticky below header logic handled by update) -->
                    <tr class="bg-emerald-50/50">
                        <td class="p-4 pl-6 font-bold text-emerald-800 sticky-col bg-emerald-50 border-r border-gray-200 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] flex items-center gap-2 h-full">
                            <i data-lucide="coins" class="w-5 h-5"></i> เบี้ยประกันมาตรฐาน (ต่อปี)
                        </td>
                        <td id="premium-1" class="p-4 text-center text-xl font-bold text-emerald-700 border-x border-gray-100">-</td>
                        <td id="premium-2" class="p-4 text-center text-xl font-bold text-emerald-700 border-x border-gray-100">-</td>
                        <td id="premium-3" class="p-4 text-center text-xl font-bold text-emerald-700 border-x border-gray-100 hidden md:table-cell">-</td>
                    </tr>
                </thead>
                <tbody id="table-body" class="divide-y divide-gray-100">
                    <!-- Data Rows injected via JS -->
                </tbody>
            </table>
        </div>

        <!-- Footer Notes -->
        <div class="bg-slate-50 p-4 border-t border-gray-200 text-xs text-gray-500">
            <div class="flex items-start gap-3 max-w-5xl mx-auto">
                <i data-lucide="alert-circle" class="w-5 h-5 text-gray-400 flex-shrink-0"></i>
                <div>
                    <p class="font-bold mb-1">เงื่อนไขสำคัญ:</p>
                    <ul class="list-disc ml-4 space-y-1">
                        <li><strong>AIA H&S Extra (HSX):</strong> เป็นแบบแยกค่าใช้จ่าย (Defined Benefit) มี OPD และ No Claim Bonus (เบี้ยในตารางเป็นเบี้ยมาตรฐาน ยังไม่รวมส่วนลด Vitality)</li>
                        <li><strong>AIA Health Saver (HSV):</strong> เป็นแบบเหมาจ่ายเริ่มต้น หมวด 3-6 และ 12 ใช้วงเงินร่วมกัน (Grouped Limit)</li>
                        <li><strong>AIA Health Happy (HH):</strong> เป็นแบบเหมาจ่ายวงเงินสูง (As Charged) โดยค่าห้องและค่าแพทย์จะจำกัดตามแผน</li>
                        <li>เบี้ยประกันภัยที่แสดงเป็นเบี้ยมาตรฐานรายปีตามช่วงอายุ (Age Band) อาจมีการเปลี่ยนแปลงตามชั้นอาชีพและประวัติสุขภาพ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA STRUCTURES ---
        
        // 1. Coverage Data (ความคุ้มครอง)
        const plans = {
            HSX: {
                name: "AIA H&S Extra",
                subtitle: "แยกจ่ายรายหมวด + OPD",
                color: "bg-emerald-50 border-emerald-400",
                options: [
                    { id: "hsx_1500", name: "แผน 1500", room: "1,500", icu: "3,000", med: "20,000", surg: "60,000", daySurg: "60,000", doc: "800", opd: "3,000", ci: "-", ncb: "1,500", death: "10,000", limit: "ไม่จำกัด" },
                    { id: "hsx_2000", name: "แผน 2000", room: "2,000", icu: "4,000", med: "20,000", surg: "80,000", daySurg: "80,000", doc: "800", opd: "4,000", ci: "-", ncb: "2,000", death: "10,000", limit: "ไม่จำกัด" },
                    { id: "hsx_2500", name: "แผน 2500", room: "2,500", icu: "5,000", med: "25,000", surg: "100,000", daySurg: "100,000", doc: "1,000", opd: "5,000", ci: "-", ncb: "2,500", death: "10,000", limit: "ไม่จำกัด" },
                    { id: "hsx_3500", name: "แผน 3500", room: "3,500", icu: "7,000", med: "35,000", surg: "120,000", daySurg: "120,000", doc: "1,200", opd: "7,000", ci: "-", ncb: "3,500", death: "10,000", limit: "ไม่จำกัด" },
                    { id: "hsx_4500", name: "แผน 4500", room: "4,500", icu: "9,000", med: "40,000", surg: "130,000", daySurg: "130,000", doc: "1,500", opd: "8,000", ci: "-", ncb: "3,500", death: "10,000", limit: "ไม่จำกัด" },
                    { id: "hsx_5500", name: "แผน 5500", room: "5,500", icu: "11,000", med: "45,000", surg: "140,000", daySurg: "140,000", doc: "2,000", opd: "9,000", ci: "-", ncb: "4,000", death: "10,000", limit: "ไม่จำกัด" },
                    { id: "hsx_6500", name: "แผน 6500", room: "6,500", icu: "13,000", med: "50,000", surg: "150,000", daySurg: "150,000", doc: "2,500", opd: "10,000", ci: "-", ncb: "4,000", death: "10,000", limit: "ไม่จำกัด" }
                ]
            },
            HSV: {
                name: "AIA Health Saver",
                subtitle: "เหมาจ่ายเริ่มต้น + เบิ้ล CI",
                color: "bg-sky-50 border-sky-400",
                options: [
                    { id: "hsv_200k", name: "แผน 2 แสน", room: "1,500", icu: "9,000", med: "เหมาจ่าย(2แสน)", surg: "เหมาจ่ายร่วม", daySurg: "เหมาจ่ายร่วม", doc: "800", opd: "-", ci: "2เท่า(4แสน)", ncb: "-", death: "10,000", limit: "200,000" },
                    { id: "hsv_300k", name: "แผน 3 แสน", room: "2,000", icu: "12,000", med: "เหมาจ่าย(3แสน)", surg: "เหมาจ่ายร่วม", daySurg: "เหมาจ่ายร่วม", doc: "1,000", opd: "-", ci: "2เท่า(6แสน)", ncb: "-", death: "10,000", limit: "300,000" },
                    { id: "hsv_400k", name: "แผน 4 แสน", room: "3,000", icu: "18,000", med: "เหมาจ่าย(4แสน)", surg: "เหมาจ่ายร่วม", daySurg: "เหมาจ่ายร่วม", doc: "1,200", opd: "1,000/ครั้ง", ci: "2เท่า(8แสน)", ncb: "-", death: "10,000", limit: "400,000" },
                    { id: "hsv_500k", name: "แผน 5 แสน", room: "4,000", icu: "24,000", med: "เหมาจ่าย(5แสน)", surg: "เหมาจ่ายร่วม", daySurg: "เหมาจ่ายร่วม", doc: "1,500", opd: "1,500/ครั้ง", ci: "2เท่า(1ล้าน)", ncb: "-", death: "10,000", limit: "500,000" }
                ]
            },
            HH: {
                name: "AIA Health Happy",
                subtitle: "เหมาจ่ายวงเงินสูง",
                color: "bg-pink-50 border-pink-400",
                options: [
                    { id: "hh_1m", name: "แผน 1 ล้าน", room: "1,500", icu: "เหมาจ่าย", med: "เหมาจ่าย", surg: "เหมาจ่าย", daySurg: "เหมาจ่าย", doc: "เหมาจ่าย", opd: "-", ci: "2เท่า(2ล้าน)", ncb: "-", death: "10,000", limit: "1 ล้าน" },
                    { id: "hh_5m", name: "แผน 5 ล้าน", room: "3,000", icu: "เหมาจ่าย", med: "เหมาจ่าย", surg: "เหมาจ่าย", daySurg: "เหมาจ่าย", doc: "เหมาจ่าย", opd: "-", ci: "2เท่า(10ล้าน)", ncb: "-", death: "10,000", limit: "5 ล้าน" },
                    { id: "hh_15m", name: "แผน 15 ล้าน", room: "6,000", icu: "เหมาจ่าย", med: "เหมาจ่าย", surg: "เหมาจ่าย", daySurg: "เหมาจ่าย", doc: "เหมาจ่าย", opd: "-", ci: "2เท่า(30ล้าน)", ncb: "-", death: "10,000", limit: "15 ล้าน" },
                    { id: "hh_25m", name: "แผน 25 ล้าน", room: "9,000", icu: "เหมาจ่าย", med: "เหมาจ่าย", surg: "เหมาจ่าย", daySurg: "เหมาจ่าย", doc: "เหมาจ่าย", opd: "2,000/ครั้ง", ci: "2เท่า(50ล้าน)", ncb: "-", death: "10,000", limit: "25 ล้าน" }
                ]
            }
        };

        // 2. Premium Data (Mocked Database based on snippets and standard curves)
        // Note: Real full tables would be huge. This is a representative lookup covering key age bands.
        const premiumDB = {
            // H&S Extra (HSX)
            HSX: {
                male:   { 0: 21000, 6: 12000, 11: 8500, 16: 9500, 21: 10500, 26: 11500, 31: 13000, 36: 15000, 41: 17000, 46: 19500, 51: 24000, 56: 30000, 61: 40000, 66: 55000 },
                female: { 0: 20000, 6: 11500, 11: 8500, 16: 10500, 21: 12500, 26: 13500, 31: 15000, 36: 17000, 41: 19000, 46: 22000, 51: 27000, 56: 33000, 61: 43000, 66: 58000 }
            },
            // Health Saver (HSV) - Approx from snippets (400k plan as baseline, scaled)
            HSV: {
                male:   { 0: 17000, 6: 11500, 11: 10888, 16: 10350, 21: 10500, 26: 10800, 31: 11500, 36: 13700, 41: 14100, 46: 15300, 51: 20200, 56: 26000, 61: 35000 },
                female: { 0: 16000, 6: 11000, 11: 12482, 16: 11831, 21: 12500, 26: 13500, 31: 15900, 36: 15941, 41: 16442, 46: 18558, 51: 23699, 56: 29000, 61: 38000 }
            },
            // Health Happy (HH) - Based on 5M plan snippet
            HH: {
                male:   { 0: 38000, 6: 36400, 11: 20200, 16: 16500, 21: 16900, 26: 18300, 31: 18900, 36: 22000, 41: 24500, 46: 27500, 51: 34000, 56: 47000, 61: 65000 },
                female: { 0: 35000, 6: 33600, 11: 18200, 16: 19100, 21: 21500, 26: 21800, 31: 22700, 36: 26000, 41: 26800, 46: 29500, 51: 36800, 56: 50000, 61: 68000 }
            }
        };
        
        // Multipliers for Plan Levels (Approximation)
        const planMultipliers = {
            HSX: [0.7, 0.8, 0.9, 1.1, 1.25, 1.4, 1.6], // 1500-6500
            HSV: [0.85, 0.92, 1.0, 1.15], // 200k-500k
            HH: [0.8, 1.0, 1.3, 1.5] // 1M-25M
        };

        // State
        let state = {
            1: { type: 'HSX', index: 2 }, // Default 2500
            2: { type: 'HSV', index: 2 }, // Default 400k
            3: { type: 'HH', index: 1 }   // Default 5M
        };

        // --- CORE FUNCTIONS ---

        function getAgeBand(age) {
            const bands = [0, 6, 11, 16, 21, 26, 31, 36, 41, 46, 51, 56, 61, 66];
            for (let i = bands.length - 1; i >= 0; i--) {
                if (age >= bands[i]) return bands[i];
            }
            return 0;
        }

        function calculatePremiumValue(type, index, age, gender) {
            const band = getAgeBand(age);
            const basePremium = premiumDB[type][gender][band] || premiumDB[type][gender][66] * 1.5; // Fallback for old age
            const multiplier = planMultipliers[type][index];
            return Math.round(basePremium * multiplier);
        }

        function formatCurrency(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function calculateAll() {
            const age = parseInt(document.getElementById('input-age').value);
            const gender = document.getElementById('input-gender').value;
            
            [1, 2, 3].forEach(col => {
                const { type, index } = state[col];
                const premium = calculatePremiumValue(type, index, age, gender);
                document.getElementById(`premium-${col}`).innerHTML = `${formatCurrency(premium)} <span class="text-xs font-normal text-gray-500">บาท</span>`;
            });
        }

        function updatePlan(col, type, index) {
            state[col] = { type, index: parseInt(index) };
            renderDropdowns(col);
            renderHeader(col);
            renderBody(); // Re-render table rows
            calculateAll(); // Re-calc premiums
        }

        function updatePlanIdx(col, index) {
            state[col].index = parseInt(index);
            renderBody();
            calculateAll();
        }

        // --- RENDER FUNCTIONS ---

        function renderDropdowns(col) {
            const currentType = state[col].type;
            const currentIndex = state[col].index;
            
            // Render Type Select
            const typeOpts = Object.keys(plans).map(k => `<option value="${k}" ${k === currentType ? 'selected' : ''}>${plans[k].name}</option>`).join('');
            document.getElementById(`sel-type-${col}`).innerHTML = typeOpts;

            // Render Option Select
            const optOpts = plans[currentType].options.map((opt, i) => `<option value="${i}" ${i === currentIndex ? 'selected' : ''}>${opt.name}</option>`).join('');
            document.getElementById(`sel-opt-${col}`).innerHTML = optOpts;
        }

        function renderHeader(col) {
            const { type, index } = state[col];
            const data = plans[type];
            const planDetail = data.options[index];

            const th = document.getElementById(`th-${col}`);
            th.className = `p-4 w-[25%] align-top border-b-4 transition-all ${data.color} ${col===3 ? 'hidden md:table-cell' : ''}`;
            
            th.innerHTML = `
                <div class="flex flex-col gap-1">
                    <div class="text-xl font-bold text-gray-800">${data.name}</div>
                    <div class="text-sm font-semibold text-teal-600">${planDetail.name}</div>
                    <div class="text-xs text-gray-500">${data.subtitle}</div>
                    <div class="mt-2 inline-block px-3 py-1 bg-white rounded-full text-xs font-bold border border-gray-200 shadow-sm">
                        วงเงิน: ${planDetail.limit}
                    </div>
                </div>
            `;
        }

        function renderCell(val, isRoom=false) {
            if (val === "เหมาจ่าย" || val === "เหมาจ่ายตามจริง") return `<span class="font-bold text-pink-600">เหมาจ่ายตามจริง</span>`;
            if (val.includes("เหมาจ่าย") || val === "เหมาจ่ายร่วม") return `<span class="text-sky-600 font-medium">${val}</span>`;
            if (val === "-" || val === "ไม่มี") return `<span class="text-gray-300">-</span>`;
            return `<span class="text-gray-800 ${isRoom ? 'font-bold text-lg' : ''}">${val}</span>`;
        }

        function createRow(label, key, icon, sub="") {
            const d1 = plans[state[1].type].options[state[1].index];
            const d2 = plans[state[2].type].options[state[2].index];
            const d3 = plans[state[3].type].options[state[3].index];
            
            return `
                <tr class="hover:bg-yellow-50 transition-colors group">
                    <td class="p-3 pl-6 border-r border-gray-100 bg-white sticky-col group-hover:bg-yellow-50">
                        <div class="flex items-center gap-2 font-medium text-gray-700">
                            ${icon ? `<i data-lucide="${icon}" class="w-4 h-4 text-slate-400"></i>` : ''} ${label}
                        </div>
                        ${sub ? `<div class="text-[10px] text-gray-400 ml-6">${sub}</div>` : ''}
                    </td>
                    <td class="p-3 text-center border-l border-gray-100">${renderCell(d1[key], key === 'room')}</td>
                    <td class="p-3 text-center border-l border-gray-100">${renderCell(d2[key], key === 'room')}</td>
                    <td class="p-3 text-center border-l border-gray-100 hidden md:table-cell">${renderCell(d3[key], key === 'room')}</td>
                </tr>
            `;
        }

        function createSection(title) {
            return `<tr class="bg-gray-100 border-y border-gray-200"><td colspan="4" class="py-2 px-6 text-xs font-bold text-gray-600 uppercase tracking-wide">${title}</td></tr>`;
        }

        function renderBody() {
            let html = "";
            // IPD
            html += createSection("1. ผลประโยชน์ผู้ป่วยใน (IPD)");
            html += createRow("หมวด 1: ค่าห้อง (ต่อวัน)", "room", "bed", "สูงสุด 125/365 วัน");
            html += createRow("ค่าห้อง ICU (ต่อวัน)", "icu", "activity", "สูงสุดตามวงเงินหรือเหมาจ่าย");
            html += createRow("หมวด 2: บริการทางการแพทย์", "med", "stethoscope", "ค่ายา, เลือด, พยาบาล");
            html += createRow("หมวด 3: ค่าแพทย์ผ่าตัด", "surg", "scissors");
            html += createRow("หมวด 4: เยี่ยมไข้ (ต่อวัน)", "doc", "user-check");
            html += createRow("หมวด 5: ผ่าตัดใหญ่ไม่ต้องนอน", "daySurg", "sun", "Day Surgery");

            // Other
            html += createSection("2. ค่ารักษาพยาบาลอื่นๆ (หมวด 6-13)");
            html += createRow("หมวด 6: ตรวจวินิจฉัย", "med", "microscope", "ก่อน/หลัง แอดมิท"); 
            html += createRow("หมวด 7: อุบัติเหตุฉุกเฉิน", "med", "zap", "ภายใน 24 ชม."); // Note: Often pooled in Cat 2 or separate limit, simplifed here mapping to med logic/limit
            html += createRow("หมวด 9: ล้างไต", "med", "droplet", "ต่อปีกรมธรรม์");
            html += createRow("หมวด 10: รักษามะเร็ง", "med", "biohazard", "เคมี/รังสี");
            html += createRow("หมวด 11: รถพยาบาล", "med", "ambulance");
            html += createRow("หมวด 12: ผ่าตัดเล็ก", "med", "pen-tool");
            html += createRow("หมวด 13: ผู้ป่วยนอก (OPD)", "opd", "users");

            // Special
            html += createSection("3. ผลประโยชน์เพิ่มเติม");
            html += createRow("โรคร้ายแรง (CI Double)", "ci", "shield-alert", "เบิ้ลวงเงิน 2 เท่า (4 ปี)");
            html += createRow("เงินคืนพิเศษ (No Claim)", "ncb", "piggy-bank");
            html += createRow("กรณีเสียชีวิต", "death", "heart");

            document.getElementById('table-body').innerHTML = html;
            lucide.createIcons();
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            // Initial Render
            [1, 2, 3].forEach(col => {
                renderDropdowns(col);
                renderHeader(col);
            });
            renderBody();
            calculateAll();
        });

    </script>
</body>
</html>

