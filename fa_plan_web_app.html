<!DOCTYPE html>
<html lang="th" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏á‡∏Ñ‡πå‡∏£‡∏ß‡∏°</title>
<!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÄ‡∏õ‡πá‡∏ô Prompt ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô -->
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
/* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ~40% (‡∏à‡∏≤‡∏Å 14px ‡πÄ‡∏õ‡πá‡∏ô 19px) */
:root{--fs:19px}
[data-theme="dark"]{--bg:#0a0e17;--bg2:#111827;--bg3:#1a2235;--card:#151d2e;--cb:#1e293b;--ac:#38bdf8;--ac2:#818cf8;--ac3:#34d399;--warn:#fbbf24;--dng:#f87171;--tx:#e2e8f0;--tx2:#94a3b8;--tx3:#64748b;--gold:#d4a853;--sbbg:linear-gradient(180deg,#0d1321,#111827);--topbg:rgba(10,14,23,.88);--hovbg:rgba(56,189,248,.04);--actbg:rgba(56,189,248,.08);--tr-hov:rgba(248,113,113,.2)}
[data-theme="light"]{--bg:#f1f5f9;--bg2:#e2e8f0;--bg3:#fff;--card:#fff;--cb:#cbd5e1;--ac:#0284c7;--ac2:#6366f1;--ac3:#059669;--warn:#d97706;--dng:#dc2626;--tx:#1e293b;--tx2:#475569;--tx3:#64748b;--gold:#b8860b;--sbbg:linear-gradient(180deg,#f8fafc,#e2e8f0);--topbg:rgba(241,245,249,.92);--hovbg:rgba(2,132,199,.06);--actbg:rgba(2,132,199,.1);--tr-hov:rgba(220,38,38,.15)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Prompt',sans-serif;background:var(--bg);color:var(--tx);line-height:1.7;font-size:var(--fs);transition:background .3s,color .3s}
.mono{font-family:'JetBrains Mono',monospace}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg2)}::-webkit-scrollbar-thumb{background:var(--tx3);border-radius:3px}
.sidebar{position:fixed;left:0;top:0;bottom:0;width:280px;background:var(--sbbg);border-right:1px solid var(--cb);z-index:100;display:flex;flex-direction:column;transition:transform .3s,background .3s}
.sidebar-hd{padding:24px 20px 16px;border-bottom:1px solid var(--cb)}
.sidebar-hd .logo{font-size:calc(var(--fs) - 5px);font-weight:700;letter-spacing:2px;color:var(--gold);text-transform:uppercase}
.sidebar-hd .ttl{font-size:calc(var(--fs) - 3px);color:var(--tx2)}
.sidebar-nav{flex:1;overflow-y:auto;padding:8px 0}
.nav-i{display:flex;align-items:center;gap:10px;padding:12px 20px;cursor:pointer;font-size:calc(var(--fs) - 3px);color:var(--tx2);transition:.2s;border-left:3px solid transparent}
.nav-i:hover{color:var(--tx);background:var(--hovbg)}
.nav-i.active{color:var(--ac);background:var(--actbg);border-left-color:var(--ac);font-weight:600}
.nav-i .ic{font-size:calc(var(--fs));width:24px;text-align:center}
.sidebar-ft{padding:14px 20px;border-top:1px solid var(--cb);font-size:calc(var(--fs) - 5px);color:var(--tx3)}
.main{margin-left:280px;min-height:100vh;transition:margin-left .3s}
.main.expanded{margin-left:0}
.sidebar.closed{transform:translateX(-100%)}
.topbar{position:sticky;top:0;z-index:50;background:var(--topbg);backdrop-filter:blur(20px);border-bottom:1px solid var(--cb);padding:12px 32px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;transition:background .3s}
.topbar h1{font-size:calc(var(--fs) + 2px);font-weight:600}
.topbar-r{display:flex;align-items:center;gap:6px;font-size:calc(var(--fs) - 4px);color:var(--tx3);flex-wrap:wrap}
.fs-btn,.th-btn{width:34px;height:34px;border-radius:8px;border:1px solid var(--cb);background:var(--bg3);color:var(--tx);cursor:pointer;font-size:calc(var(--fs) - 2px);display:flex;align-items:center;justify-content:center;transition:.2s}
.fs-btn:hover,.th-btn:hover{border-color:var(--ac);color:var(--ac)}
.sep{width:1px;height:24px;background:var(--cb);margin:0 4px}
.content{padding:24px 32px 50px}
.section{display:none}.section.active{display:block;animation:fadeIn .35s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
.card{background:var(--card);border:1px solid var(--cb);border-radius:16px;padding:24px;margin-bottom:20px;box-shadow:0 4px 24px rgba(0,0,0,.12);transition:background .3s,border .3s}
.card-h{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.card-h .bdg{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:calc(var(--fs) + 2px);flex-shrink:0}
.card-h h2{font-size:calc(var(--fs));font-weight:600}.card-h .sub{font-size:calc(var(--fs) - 4px);color:var(--tx3)}
.b-bl{background:rgba(56,189,248,.15);color:var(--ac)}.b-pu{background:rgba(129,140,248,.15);color:var(--ac2)}.b-gr{background:rgba(52,211,153,.15);color:var(--ac3)}.b-go{background:rgba(212,168,83,.15);color:var(--gold)}.b-rd{background:rgba(248,113,113,.15);color:var(--dng)}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:20px}.g3{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}.g4{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
.kpi{background:var(--bg3);border:1px solid var(--cb);border-radius:12px;padding:16px;transition:background .3s}
.kpi .lb{font-size:calc(var(--fs) - 4px);color:var(--tx3);margin-bottom:4px;font-weight:500}.kpi .vl{font-size:calc(var(--fs) + 6px);font-weight:700;letter-spacing:-.5px}.kpi .ch{font-size:calc(var(--fs) - 5px);margin-top:3px;font-weight:500}
.ch.good{color:var(--ac3)}.ch.warn{color:var(--warn)}.ch.bad{color:var(--dng)}
.tw{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:calc(var(--fs) - 2px)}
th{text-align:left;padding:10px 14px;font-weight:600;font-size:calc(var(--fs) - 4px);text-transform:uppercase;letter-spacing:.5px;color:var(--tx3);border-bottom:1px solid var(--cb);white-space:nowrap}
td{padding:10px 14px;border-bottom:1px solid rgba(100,116,139,.15);white-space:nowrap;transition:background .2s}
tr:hover td{background:var(--tr-hov)}
.tr{text-align:right}.tc{text-align:center}
.num{font-family:'JetBrains Mono',monospace;font-size:calc(var(--fs) - 2px)}
.pos{color:var(--ac3)}.neg{color:var(--dng)}
.chart-box{position:relative;height:350px;margin:10px 0}
.chart-sm{position:relative;height:250px;margin:10px 0}
.st{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:16px;font-size:calc(var(--fs) - 4px);font-weight:600}
.st-ok{background:rgba(52,211,153,.15);color:var(--ac3)}.st-no{background:rgba(248,113,113,.15);color:var(--dng)}
.tabs{display:flex;gap:3px;margin-bottom:16px;background:var(--bg);border-radius:10px;padding:4px}
.tab-b{padding:8px 18px;border-radius:7px;font-size:calc(var(--fs) - 3px);font-weight:600;cursor:pointer;border:none;background:transparent;color:var(--tx3);transition:.2s;font-family:inherit;}
.tab-b.active{background:var(--ac);color:#fff}.tab-b:hover:not(.active){color:var(--tx)}
[data-theme="dark"] .tab-b.active{color:#0a0e17}
.hl{background:linear-gradient(135deg,rgba(56,189,248,.08),rgba(129,140,248,.08));border:1px solid rgba(56,189,248,.2);border-radius:12px;padding:20px;margin:16px 0}
.gold-ln{height:2px;background:linear-gradient(90deg,var(--gold),transparent);margin:16px 0}
.fi{background:var(--bg);border:1px solid var(--cb);border-radius:8px;padding:8px 12px;color:var(--tx);font-family:inherit;font-size:calc(var(--fs) - 2px);width:100%;transition:.2s}
.fi:focus{outline:none;border-color:var(--ac);box-shadow:0 0 0 2px rgba(56,189,248,.15)}
.fi-sm{width:150px;text-align:right}.fi-xs{width:110px;text-align:right}
.fi-row{display:grid;grid-template-columns:220px 1fr;gap:10px;align-items:center;margin-bottom:10px}
.fi-row label{font-size:calc(var(--fs) - 2px);color:var(--tx2);font-weight:500}
.btn{padding:8px 18px;border-radius:8px;border:none;font-size:calc(var(--fs) - 3px);font-weight:600;cursor:pointer;transition:.2s;font-family:inherit}
.btn-ac{background:var(--ac);color:#fff}.btn-ac:hover{opacity:.85}
[data-theme="dark"] .btn-ac{color:#0a0e17}
.btn-go{background:var(--gold);color:#fff}.btn-go:hover{opacity:.9}
[data-theme="dark"] .btn-go{color:#0a0e17}
.btn-out{background:transparent;border:1px solid var(--cb);color:var(--tx2)}.btn-out:hover{border-color:var(--ac);color:var(--ac)}
.btn-sm{padding:6px 12px;font-size:calc(var(--fs) - 4px);border-radius:6px}
.edit-only{display:none}
.cf-cat{font-weight:600;padding:8px 14px;font-size:calc(var(--fs) - 2px)}
.cf-cat-inc{color:var(--ac3);background:rgba(52,211,153,.05)}.cf-cat-exp{color:var(--dng);background:rgba(248,113,113,.05)}.cf-cat-fix{color:var(--warn);background:rgba(251,191,36,.05)}
.cf-input{background:var(--bg);border:1px solid var(--cb);border-radius:4px;padding:4px 8px;width:95px;text-align:right;color:var(--tx);font-family:'JetBrains Mono',monospace;font-size:calc(var(--fs) - 3px)}
.cf-input:focus{outline:none;border-color:var(--ac)}
.bs-input{background:var(--bg);border:1px solid var(--cb);border-radius:4px;padding:4px 8px;width:140px;text-align:right;color:var(--tx);font-family:'JetBrains Mono',monospace;font-size:calc(var(--fs) - 2px)}
.bs-input:focus{outline:none;border-color:var(--ac)}
.bs-name{background:var(--bg);border:1px solid var(--cb);border-radius:4px;padding:4px 8px;width:200px;color:var(--tx);font-size:calc(var(--fs) - 2px);font-family:inherit}
.bs-name:focus{outline:none;border-color:var(--ac)}
.param-card{background:var(--bg3);border:1px solid var(--cb);border-radius:12px;padding:24px;margin-bottom:16px;transition:background .3s}
.param-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.param-item{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(100,116,139,.15)}
.param-item label{font-size:calc(var(--fs) - 2px);color:var(--tx2)}
.param-item .fi{width:150px;text-align:right}
.profile-g{display:grid;grid-template-columns:auto 1fr;gap:8px 20px;font-size:calc(var(--fs) - 2px)}
.profile-g dt{color:var(--tx3);font-weight:500}.profile-g dd{color:var(--tx)}
.io-bar{display:flex;gap:8px;align-items:center}
@media(max-width:1200px){.g4{grid-template-columns:1fr 1fr}}
@media(max-width:900px){.sidebar{transform:translateX(-100%)}.sidebar.open{transform:translateX(0)}.main{margin-left:0}.g2,.g3,.g4{grid-template-columns:1fr}.content{padding:16px 12px 40px}.topbar{padding:10px 12px}.menu-toggle{display:block!important}}
.menu-toggle{background:none;border:none;color:var(--tx);font-size:24px;cursor:pointer}

@media print{
  @page{size:A4 landscape;margin:10mm}
  body{background:#fff!important;color:#000!important;font-size:11px!important;-webkit-print-color-adjust:exact;print-color-adjust:exact;width:100%!important}
  .sidebar,.topbar,.menu-toggle,.btn,.fs-btn,.th-btn,.io-bar,.param-card .btn,.sep,#impFile,.no-print{display:none!important}
  
  input, select, textarea {
      color: #000 !important;
      background: transparent !important;
      border: none !important;
      outline: none !important;
      box-shadow: none !important;
      -webkit-appearance: none !important;
      -moz-appearance: none !important;
      appearance: none !important;
      font-size: 11px !important;
      font-family: inherit !important;
  }
  input[type="number"]::-webkit-inner-spin-button, 
  input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none !important;
      margin: 0 !important;
  }
  .cf-input, .bs-input, .bs-name {
      display: inline-block !important;
      padding: 0 !important;
  }
  .cf-input { width: 100% !important; min-width: 50px; }
  .bs-input { width: 100% !important; }
  .bs-name { width: auto !important; }
  
  .main{margin-left:0!important;width:100%!important}
  .content{padding:0!important;width:100%!important}
  .section{display:none!important}
  .section.print-active{display:block!important}
  .card{box-shadow:none!important;border:1px solid #cbd5e1!important;break-inside:avoid;page-break-inside:avoid;margin-bottom:15px!important;padding:15px!important;width:100%!important}
  .kpi{border:1px solid #cbd5e1!important;background:#f8fafc!important}
  .g2,.g3,.g4{gap:12px!important}
  .chart-box,.chart-sm{height:240px!important;page-break-inside:avoid}
  .hl{border:1px solid #cbd5e1!important;background:#f8fafc!important}
  .tw{overflow-x:visible!important;width:100%!important}
  table{width:100%!important;font-size:10px!important}
  td,th{padding:5px 6px!important;color:#000!important;border-bottom:1px solid #cbd5e1!important;white-space:normal!important}
  th{white-space:nowrap!important}
  .print-hdr{display:block!important;text-align:center;margin-bottom:15px;padding-bottom:8px;border-bottom:2px solid #1e293b}
  .print-hdr h1{font-size:18px;font-weight:700;color:#1e293b}.print-hdr p{font-size:11px;color:#475569}
}
.print-hdr{display:none}

</style>
</head>
<body>
<nav class="sidebar" id="sidebar">
<div class="sidebar-hd"><div class="logo">Financial Advisory</div><div class="ttl">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏á‡∏Ñ‡πå‡∏£‡∏ß‡∏°</div></div>
<div class="sidebar-nav">
<div class="nav-i active" data-s="dashboard"><span class="ic">üìä</span>Dashboard</div>
<div class="nav-i" data-s="balance"><span class="ic">üìã</span>‡∏á‡∏ö‡∏î‡∏∏‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</div>
<div class="nav-i" data-s="cashflow"><span class="ic">üíµ</span>‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</div>
<div class="nav-i" data-s="ratio"><span class="ic">üìê</span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</div>
<div class="nav-i" data-s="retirement"><span class="ic">üèñÔ∏è</span>‡πÅ‡∏ú‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏</div>
<div class="nav-i" data-s="retfund"><span class="ic">üìà</span>‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡∏û‡∏∂‡∏á‡∏°‡∏µ</div>
<div class="nav-i" data-s="investment"><span class="ic">üíé</span>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô</div>
</div>
<div class="sidebar-ft">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô: 22 ‡∏û.‡∏¢. 2567</div>
</nav>
<div class="main">
<div class="topbar">
<div style="display:flex;align-items:center;gap:10px">
<button class="menu-toggle" onclick="toggleNav()">‚ò∞</button>
<h1 id="topT">Dashboard ‚Äî ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h1>
</div>
<div class="topbar-r">
<span>‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>
<button class="fs-btn" onclick="changeFontSize(-1)">A‚àí</button>
<button class="fs-btn" onclick="changeFontSize(1)">A+</button>
<button class="fs-btn" onclick="changeFontSize(0)">‚ü≤</button>
<!-- ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 19px -->
<span id="fsLabel">19px</span>
<div class="sep"></div>
<button class="th-btn" onclick="toggleTheme()" id="thBtn" title="‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏°">üåô</button>
<div class="sep"></div>
<div class="io-bar">
<button class="btn btn-out btn-sm" onclick="exportData()">üíæ Export</button>
<button class="btn btn-out btn-sm" onclick="document.getElementById('impFile').click()">üìÇ Import</button>
<button class="btn btn-out btn-sm" onclick="printCurrentTab()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
<input type="file" id="impFile" accept=".json" style="display:none" onchange="importData(event)">
</div>
</div>
</div>
<div class="content">

<!-- DASHBOARD -->
<div class="section active" id="sec-dashboard">
<div class="print-hdr"><h1>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏á‡∏Ñ‡πå‡∏£‡∏ß‡∏° ‚Äî Dashboard</h1><p id="ph-dash"></p></div>
<div class="g4" style="margin-bottom:20px" id="dashKPI"></div>
<div class="g2">
<div class="card" id="profileCard">
<div class="card-h"><div class="bdg b-bl">üë§</div><div style="flex:1"><h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h2><div class="sub">Client Profile</div></div>
<button class="btn btn-out btn-sm" onclick="toggleEdit('profile')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></div>
<div id="profileView"><dl class="profile-g" id="profileDL"></dl></div>
<div id="profileEdit" class="edit-only">
<div class="fi-row"><label>‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏™‡∏Å‡∏∏‡∏•</label><input class="fi" id="e_name"></div>
<div class="fi-row"><label>‡πÄ‡∏û‡∏®</label><select class="fi" id="e_gender"><option>‡∏´‡∏ç‡∏¥‡∏á</option><option>‡∏ä‡∏≤‡∏¢</option></select></div>
<div class="fi-row"><label>‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label><input class="fi fi-sm" id="e_age" type="number"></div>
<div class="fi-row"><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û</label><select class="fi" id="e_status"><option>‡πÇ‡∏™‡∏î</option><option>‡∏™‡∏°‡∏£‡∏™</option><option>‡∏´‡∏¢‡πà‡∏≤</option></select></div>
<div class="fi-row"><label>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</label><input class="fi" id="e_job"></div>
<div class="fi-row"><label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</label><input class="fi" id="e_company"></div>
<div style="display:flex;gap:8px;margin-top:12px"><button class="btn btn-ac" onclick="saveProfile()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button><button class="btn btn-out" onclick="toggleEdit('profile')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button></div>
</div></div>
<div class="card" id="assumCard">
<div class="card-h"><div class="bdg b-go">‚öôÔ∏è</div><div style="flex:1"><h2>‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡∏ê‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</h2><div class="sub">Key Assumptions</div></div>
<button class="btn btn-out btn-sm" onclick="toggleEdit('assum')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></div>
<div id="assumView"><dl class="profile-g" id="assumDL"></dl></div>
<div id="assumEdit" class="edit-only">
<div class="fi-row"><label>‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (‡∏õ‡∏µ)</label><input class="fi fi-sm" id="a_retAge" type="number" value="60"></div>
<div class="fi-row"><label>‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î (‡∏õ‡∏µ)</label><input class="fi fi-sm" id="a_endAge" type="number" value="85"></div>
<div class="fi-row"><label>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô (%/‡∏õ‡∏µ)</label><input class="fi fi-sm" id="a_incGrow" type="number" step="0.1" value="2.0"></div>
<div class="fi-row"><label>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (%/‡∏õ‡∏µ)</label><input class="fi fi-sm" id="a_infGen" type="number" step="0.1" value="2.5"></div>
<div class="fi-row"><label>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤ (%/‡∏õ‡∏µ)</label><input class="fi fi-sm" id="a_infMed" type="number" step="0.1" value="10.0"></div>
<div class="fi-row"><label>‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (%/‡∏õ‡∏µ)</label><input class="fi fi-sm" id="a_retReturn" type="number" step="0.1" value="3.0"></div>
<div class="fi-row"><label>‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á (%/‡∏õ‡∏µ)</label><input class="fi fi-sm" id="a_pvdReturn" type="number" step="0.1" value="5.0"></div>
<div class="fi-row"><label>‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ)</label><input class="fi fi-sm" id="a_addInvest" type="number" step="1000" value="60000"></div>
<div style="display:flex;gap:8px;margin-top:12px"><button class="btn btn-ac" onclick="saveAssumptions()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å & ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà</button><button class="btn btn-out" onclick="toggleEdit('assum')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button></div>
</div></div>
</div>
<div class="card"><div class="card-h"><div class="bdg b-gr">üìê</div><div><h2>‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h2></div></div><div class="g3" id="ratioSnap"></div></div>
<div class="card"><div class="card-h"><div class="bdg b-pu">üìä</div><div><h2>‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå vs ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô</h2></div></div><div class="g2"><div class="chart-sm"><canvas id="cAssetPie"></canvas></div><div class="chart-sm"><canvas id="cNetWorth"></canvas></div></div></div>
</div>

<!-- BALANCE SHEET (editable) -->
<div class="section" id="sec-balance">
<div class="print-hdr"><h1>‡∏á‡∏ö‡∏î‡∏∏‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (Personal Balance Sheet)</h1><p id="ph-bal"></p></div>
<div style="display:flex;justify-content:flex-end;margin-bottom:12px"><button class="btn btn-go btn-sm" onclick="renderBalanceSheet();renderDashKPI();renderDashCharts();renderRatioSnap();renderRatioTable()">üîÑ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button></div>
<div class="g2">
<div class="card">
<div class="card-h"><div class="bdg b-bl">üí∞</div><div style="flex:1"><h2>‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå (Assets)</h2></div>
<button class="btn btn-ac btn-sm" onclick="addBSRow('asset')">Ôºã ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></div>
<div class="tw"><table id="tblAsset"></table></div>
</div>
<div class="card">
<div class="card-h"><div class="bdg b-rd">üè¶</div><div style="flex:1"><h2>‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô (Liabilities)</h2></div>
<button class="btn btn-ac btn-sm" onclick="addBSRow('liab')">Ôºã ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></div>
<div class="tw"><table id="tblLiab"></table></div>
<div class="gold-ln"></div>
<div class="hl" id="bsNetWorth"></div>
</div>
</div></div>
<!-- CASHFLOW -->
<div class="section" id="sec-cashflow">
<div class="print-hdr"><h1>‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ (Cash Flow Statement)</h1><p id="ph-cf"></p></div>
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
<div class="tabs" style="margin-bottom:0"><button class="tab-b active" data-t="cfM">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button><button class="tab-b" data-t="cfA">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</button><button class="tab-b" data-t="cfC">‡πÅ‡∏ú‡∏ô‡∏†‡∏π‡∏°‡∏¥</button></div>
<button class="btn btn-go btn-sm" onclick="cfChanged();recalcAll()">üîÑ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>
<div id="cfM" class="tab-c"><div class="g4" style="margin-bottom:20px" id="cfKPI"></div>
<div class="card"><div class="card-h"><div class="bdg b-gr">üíµ</div><div style="flex:1"><h2>‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‚Äî ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ</h2></div>
<button class="btn btn-ac btn-sm" onclick="addCFRow()">Ôºã ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></div>
<div class="tw"><table id="tblCF"></table></div></div></div>
<div id="cfA" class="tab-c" style="display:none"><div class="card"><div class="card-h"><div class="bdg b-bl">üìä</div><div><h2>‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</h2></div></div><div id="cfAnnual"></div></div></div>
<div id="cfC" class="tab-c" style="display:none">
<div class="g2"><div class="card"><div class="card-h"><div class="bdg b-gr">üìä</div><div><h2>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2></div></div><div class="chart-box"><canvas id="cCFBar"></canvas></div></div>
<div class="card"><div class="card-h"><div class="bdg b-pu">üç©</div><div><h2>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2></div></div><div class="chart-box"><canvas id="cExpPie"></canvas></div></div></div>
<div class="card"><div class="card-h"><div class="bdg b-bl">üìà</div><div><h2>‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏™‡∏∞‡∏™‡∏°</h2></div></div><div class="chart-box"><canvas id="cCumCF"></canvas></div></div>
</div></div>

<!-- RATIOS -->
<div class="section" id="sec-ratio">
<div class="print-hdr"><h1>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (Financial Ratio)</h1><p id="ph-ratio"></p></div>
<div class="card"><div class="card-h"><div class="bdg b-pu">üìê</div><div><h2>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (Financial Ratio)</h2><div class="sub">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‚Äî ‡∏ï‡∏≤‡∏° Fin Ratio ‡πÉ‡∏ô Excel</div></div></div>
<div id="ratioDetail"></div></div>
<div class="card"><div class="card-h"><div class="bdg b-bl">üìä</div><div><h2>‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô</h2></div></div><div class="chart-box"><canvas id="cRatioBar"></canvas></div></div>
</div>

<!-- RETIREMENT -->
<div class="section" id="sec-retirement">
<div class="print-hdr"><h1>‡πÅ‡∏ú‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏ (Retirement Plan)</h1><p id="ph-ret"></p></div>
<div class="param-card">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
<h3 style="font-size:calc(var(--fs));color:var(--gold)">‚öôÔ∏è ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</h3>
<button class="btn btn-go btn-sm" onclick="recalcRetirement()">üîÑ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà</button></div>
<div class="param-grid">
<div class="param-item"><label>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ)</label><div style="display:flex;gap:6px;align-items:center"><input class="fi fi-sm" id="r_curExp" type="number" step="1000" value="360000"><button class="btn btn-out btn-sm" onclick="pullExpFromCF()" title="‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î">üì• ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å CF</button></div></div>
<div class="param-item"><label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠ (%/‡∏õ‡∏µ)</label><input class="fi fi-xs" id="r_inf" type="number" step="0.1" value="2.5"></div>
<div class="param-item"><label>‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</label><input class="fi fi-xs" id="r_retAge" type="number" value="60"></div>
<div class="param-item"><label>‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label><input class="fi fi-xs" id="r_endAge" type="number" value="85"></div>
<div class="param-item"><label>‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (%/‡∏õ‡∏µ)</label><input class="fi fi-xs" id="r_retRtn" type="number" step="0.1" value="3.0"></div>
<div class="param-item"><label>‡πÅ‡∏´‡∏•‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏° ‡∏ì ‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (‡∏ö‡∏≤‡∏ó)</label><input class="fi fi-sm" id="r_accum" type="number" step="10000" value="2700000"></div>
</div></div>
<div class="g4" style="margin-bottom:20px" id="retKPI"></div>
<div class="card"><div class="card-h"><div class="bdg b-go">üèñÔ∏è</div><div><h2>‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ú‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏</h2></div></div><div class="g2" id="retSummary"></div></div>
<div class="card"><div class="card-h"><div class="bdg b-gr">üìà</div><div><h2>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</h2><div class="sub" id="retInvLbl"></div></div></div><div class="chart-box"><canvas id="cRetGrow"></canvas></div></div>
</div>

<!-- RETIREMENT FUND -->
<div class="section" id="sec-retfund">
<div class="print-hdr"><h1>‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡∏û‡∏∂‡∏á‡∏°‡∏µ (Retirement Fund Simulation)</h1><p id="ph-rf"></p></div>
<div class="param-card">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
<h3 style="font-size:calc(var(--fs));color:var(--gold)">‚öôÔ∏è ‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</h3>
<button class="btn btn-go btn-sm" onclick="recalcRetFund()">üîÑ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà</button></div>
<div class="param-grid">
<div class="param-item"><label>‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ö‡∏≤‡∏ó)</label><input class="fi fi-sm" id="rf_fund" type="number" step="100000" value="19159683"></div>
<div class="param-item"><label>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏µ‡πÅ‡∏£‡∏Å (‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ)</label><input class="fi fi-sm" id="rf_exp1" type="number" step="1000" value="875713"></div>
<div class="param-item"><label>‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (%/‡∏õ‡∏µ)</label><input class="fi fi-xs" id="rf_rtn" type="number" step="0.1" value="3.0"></div>
<div class="param-item"><label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠ (%/‡∏õ‡∏µ)</label><input class="fi fi-xs" id="rf_inf" type="number" step="0.1" value="2.5"></div>
<div class="param-item"><label>‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</label><input class="fi fi-xs" id="rf_startAge" type="number" value="60"></div>
<div class="param-item"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</label><input class="fi fi-xs" id="rf_years" type="number" value="25"></div>
</div></div>
<div class="hl" style="margin-bottom:20px" id="rfBanner"></div>
<div class="card"><div class="card-h"><div class="bdg b-go">üìã</div><div><h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì ‚Äî ‡∏õ‡∏µ‡∏ï‡πà‡∏≠‡∏õ‡∏µ</h2></div></div><div class="tw"><table id="tblRF"></table></div></div>
<div class="card"><div class="card-h"><div class="bdg b-rd">üìâ</div><div><h2>‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h2></div></div><div class="chart-box"><canvas id="cRFLine"></canvas></div></div>
</div>

<!-- INVESTMENT -->
<div class="section" id="sec-investment">
<div class="print-hdr"><h1>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô (Investment Plan)</h1><p id="ph-inv"></p></div>
<div class="card"><div class="card-h"><div class="bdg b-pu">üíé</div><div><h2>‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì ‚Äî ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</h2></div></div><div class="tw"><table id="tblInv"></table></div></div>
<div class="card"><div class="card-h"><div class="bdg b-bl">üìä</div><div><h2>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏™‡∏∞‡∏™‡∏°</h2></div></div><div class="chart-box"><canvas id="cInvGrow"></canvas></div></div>
<div class="card"><div class="card-h"><div class="bdg b-gr">üìà</div><div><h2>Budget Projection 50 ‡∏õ‡∏µ</h2></div></div><div class="chart-box" style="height:380px"><canvas id="cBudget"></canvas></div></div>
</div>

</div></div>
<script>
// ===== GLOBALS =====
let APP={
  client:{name:'‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô',gender:'‡∏´‡∏ç‡∏¥‡∏á',age:25,status:'‡πÇ‡∏™‡∏î',job:'‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô/‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á',company:'work from home'},
  assum:{retAge:60,endAge:85,incGrow:0.02,infGen:0.025,infMed:0.10,retReturn:0.03,pvdReturn:0.05,addInvest:60000},
  charts:{}
};
const F=n=>new Intl.NumberFormat('th-TH').format(Math.round(n));
const FM=n=>(n/1e6).toFixed(2)+' ‡∏•‡πâ‡∏≤‡∏ô';
const P=n=>(n*100).toFixed(1)+'%';
Chart.defaults.color='#94a3b8';Chart.defaults.borderColor='rgba(30,41,59,.4)';
Chart.defaults.font.family="'Prompt','JetBrains Mono',sans-serif";Chart.defaults.font.size=13; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏î‡πâ‡∏ß‡∏¢

// ===== THEME =====
function toggleTheme(){
  const html=document.documentElement;
  const isDark=html.getAttribute('data-theme')==='dark';
  html.setAttribute('data-theme',isDark?'light':'dark');
  document.getElementById('thBtn').textContent=isDark?'‚òÄÔ∏è':'üåô';
  Chart.defaults.color=isDark?'#475569':'#94a3b8';
  Chart.defaults.borderColor=isDark?'rgba(203,213,225,.3)':'rgba(30,41,59,.4)';
  Object.values(APP.charts).forEach(c=>{try{c.update()}catch(e){}});
}

// ===== FONT SIZE =====
// ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Default ‡πÄ‡∏õ‡πá‡∏ô 19px ‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢ 40%
let currentFS=19;
function changeFontSize(d){
  if(d===0)currentFS=19;else currentFS=Math.max(12,Math.min(28,currentFS+d));
  document.documentElement.style.setProperty('--fs',currentFS+'px');
  document.getElementById('fsLabel').textContent=currentFS+'px';
}

// ===== NAVIGATION =====
function toggleNav(){
  const sb=document.getElementById('sidebar'), mn=document.querySelector('.main');
  if(window.innerWidth<=900){sb.classList.toggle('open');}
  else{sb.classList.toggle('closed');mn.classList.toggle('expanded');}
  setTimeout(()=>{Object.values(APP.charts).forEach(c=>{try{c.resize()}catch(e){}});},300);
}

document.querySelectorAll('.nav-i').forEach(n=>{
  n.addEventListener('click',()=>{
    const s=n.dataset.s;
    document.querySelectorAll('.nav-i').forEach(x=>x.classList.remove('active'));n.classList.add('active');
    document.querySelectorAll('.section').forEach(x=>x.classList.remove('active'));
    document.getElementById('sec-'+s).classList.add('active');
    const T={dashboard:'Dashboard ‚Äî ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô',balance:'‡∏á‡∏ö‡∏î‡∏∏‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•',cashflow:'‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î',ratio:'‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô',retirement:'‡πÅ‡∏ú‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏',retfund:'‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡∏û‡∏∂‡∏á‡∏°‡∏µ',investment:'‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô'};
    document.getElementById('topT').textContent=T[s]||'';
    document.getElementById('sidebar').classList.remove('open');
  });
});
document.querySelectorAll('.tab-b').forEach(b=>{
  b.addEventListener('click',()=>{
    const p=b.closest('.section');
    p.querySelectorAll('.tab-b').forEach(x=>x.classList.remove('active'));
    p.querySelectorAll('.tab-c').forEach(x=>x.style.display='none');
    b.classList.add('active');document.getElementById(b.dataset.t).style.display='block';
  });
});

// ===== CHART HELPER =====
function uChart(id,type,data,opts){
  if(APP.charts[id])APP.charts[id].destroy();
  const ctx=document.getElementById(id);if(!ctx)return;
  APP.charts[id]=new Chart(ctx,{type,data,options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top',labels:{usePointStyle:true,padding:14,font:{size:12}}}},...(opts||{})}});
}

// ===== EDIT TOGGLE =====
function toggleEdit(sec){
  const v=document.getElementById(sec==='profile'?'profileView':'assumView');
  const e=document.getElementById(sec==='profile'?'profileEdit':'assumEdit');
  const show=e.style.display!=='block';
  v.style.display=show?'none':'block';e.style.display=show?'block':'none';
  if(show&&sec==='profile'){
    document.getElementById('e_name').value=APP.client.name;
    document.getElementById('e_age').value=APP.client.age;
    document.getElementById('e_job').value=APP.client.job;
    document.getElementById('e_company').value=APP.client.company;
  }
}
function saveProfile(){
  APP.client.name=document.getElementById('e_name').value;
  APP.client.gender=document.getElementById('e_gender').value;
  APP.client.age=+document.getElementById('e_age').value;
  APP.client.status=document.getElementById('e_status').value;
  APP.client.job=document.getElementById('e_job').value;
  APP.client.company=document.getElementById('e_company').value;
  renderProfile();toggleEdit('profile');recalcAll();
}
function saveAssumptions(){
  const a=APP.assum;
  a.retAge=+document.getElementById('a_retAge').value;a.endAge=+document.getElementById('a_endAge').value;
  a.incGrow=+document.getElementById('a_incGrow').value/100;a.infGen=+document.getElementById('a_infGen').value/100;
  a.infMed=+document.getElementById('a_infMed').value/100;a.retReturn=+document.getElementById('a_retReturn').value/100;
  a.pvdReturn=+document.getElementById('a_pvdReturn').value/100;a.addInvest=+document.getElementById('a_addInvest').value;
  document.getElementById('r_inf').value=(a.infGen*100).toFixed(1);
  document.getElementById('r_retAge').value=a.retAge;document.getElementById('r_endAge').value=a.endAge;
  document.getElementById('r_retRtn').value=(a.retReturn*100).toFixed(1);
  document.getElementById('rf_rtn').value=(a.retReturn*100).toFixed(1);
  document.getElementById('rf_inf').value=(a.infGen*100).toFixed(1);
  renderAssumptions();toggleEdit('assum');recalcAll();
}

// ===== BALANCE SHEET DATA =====
const bsAssets=[
  {grp:'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á',name:'‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î / ‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å',val:300000},
  {grp:'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏•‡∏á‡∏ó‡∏∏‡∏ô',name:'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°',val:0},
  {grp:'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß',name:'‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå',val:600000},
  {grp:'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß',name:'‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢',val:2000000}
];
const bsLiabs=[
  {grp:'‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô',name:'‡∏´‡∏ô‡∏µ‡πâ‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô',val:30000},
  {grp:'‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß',name:'‡∏´‡∏ô‡∏µ‡πâ‡∏ú‡πà‡∏≠‡∏ô‡∏£‡∏ñ',val:500000}
];
function addBSRow(type){
  const name=prompt('‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:');if(!name)return;
  const grp=prompt('‡∏Å‡∏•‡∏∏‡πà‡∏°:',type==='asset'?'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß':'‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß');if(!grp)return;
  (type==='asset'?bsAssets:bsLiabs).push({grp:grp,name:name,val:0});
  renderBalanceSheet();
}
function removeBSRow(type,i){
  const arr=type==='asset'?bsAssets:bsLiabs;
  if(confirm('‡∏•‡∏ö "'+arr[i].name+'" ?')){arr.splice(i,1);renderBalanceSheet();}
}
function bsChanged(){
  bsAssets.forEach((item,i)=>{const el=document.getElementById('bs_a_'+i);if(el)item.val=+el.value;});
  bsLiabs.forEach((item,i)=>{const el=document.getElementById('bs_l_'+i);if(el)item.val=+el.value;});
  renderBSSummary();renderDashKPI();renderDashCharts();renderRatioSnap();renderRatioTable();
}
function renderBalanceSheet(){
  // Assets table
  const totA=bsAssets.reduce((a,i)=>a+i.val,0);
  let h='<thead><tr><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th class="tr">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)</th><th class="tr">%</th><th></th></tr></thead><tbody>';
  let lastG='';
  const gColors={'‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á':'var(--ac)','‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏•‡∏á‡∏ó‡∏∏‡∏ô':'var(--ac2)','‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÉ‡∏ä‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß':'var(--ac3)'};
  bsAssets.forEach((item,i)=>{
    if(item.grp!==lastG){lastG=item.grp;h+='<tr style="background:var(--hovbg)"><td colspan=4 style="font-weight:600;color:'+(gColors[item.grp]||'var(--tx)')+'">‚Ä¢ '+item.grp+'</td></tr>';}
    const pct=totA>0?(item.val/totA*100).toFixed(1):'0';
    h+='<tr><td><input class="bs-name" value="'+item.name+'" onchange="bsAssets['+i+'].name=this.value"></td><td class="tr"><input class="bs-input" id="bs_a_'+i+'" type="number" value="'+item.val+'" onchange="bsChanged()"></td><td class="tr num">'+pct+'%</td><td><button style="color:var(--dng);background:none;border:none;cursor:pointer" onclick="removeBSRow(\'asset\','+i+')">‚úï</button></td></tr>';
  });
  h+='<tr style="font-weight:700;border-top:2px solid var(--ac)"><td>‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏°</td><td class="tr num">'+F(totA)+'</td><td class="tr num">100%</td><td></td></tr></tbody>';
  document.getElementById('tblAsset').innerHTML=h;
  // Liabilities table
  const totL=bsLiabs.reduce((a,i)=>a+i.val,0);
  h='<thead><tr><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th class="tr">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)</th><th class="tr">%</th><th></th></tr></thead><tbody>';
  lastG='';
  bsLiabs.forEach((item,i)=>{
    if(item.grp!==lastG){lastG=item.grp;h+='<tr style="background:var(--hovbg)"><td colspan=4 style="font-weight:600;color:var(--dng)">‚Ä¢ '+item.grp+'</td></tr>';}
    const pct=totA>0?(item.val/totA*100).toFixed(1):'0';
    h+='<tr><td><input class="bs-name" value="'+item.name+'" onchange="bsLiabs['+i+'].name=this.value"></td><td class="tr"><input class="bs-input" id="bs_l_'+i+'" type="number" value="'+item.val+'" onchange="bsChanged()"></td><td class="tr num">'+pct+'%</td><td><button style="color:var(--dng);background:none;border:none;cursor:pointer" onclick="removeBSRow(\'liab\','+i+')">‚úï</button></td></tr>';
  });
  h+='<tr style="font-weight:700;border-top:2px solid var(--dng)"><td>‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏ß‡∏°</td><td class="tr num">'+F(totL)+'</td><td class="tr num">'+(totA>0?(totL/totA*100).toFixed(1):'0')+'%</td><td></td></tr></tbody>';
  document.getElementById('tblLiab').innerHTML=h;
  renderBSSummary();
}
function renderBSSummary(){
  const totA=bsAssets.reduce((a,i)=>a+i.val,0);
  const totL=bsLiabs.reduce((a,i)=>a+i.val,0);
  const nw=totA-totL;
  document.getElementById('bsNetWorth').innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><div><div style="font-size:calc(var(--fs) - 4px);color:var(--tx3)">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (Net Worth)</div><div style="font-size:calc(var(--fs) + 12px);font-weight:800;color:var(--ac3)">‡∏ø '+F(nw)+'</div><div style="font-size:calc(var(--fs) - 4px);color:var(--tx3)">'+P(totA>0?nw/totA:0)+' ‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏°</div></div><div style="font-size:calc(var(--fs) + 16px)">üèÜ</div></div>';
}

// ===== EXPORT / IMPORT =====
function exportData(){
  const data={
    client:APP.client,assum:APP.assum,
    bsAssets:bsAssets.map(i=>({grp:i.grp,name:i.name,val:i.val})),
    bsLiabs:bsLiabs.map(i=>({grp:i.grp,name:i.name,val:i.val})),
    cfItems:cfItems.map(i=>({cat:i.cat,grp:i.grp,name:i.name,m:[...i.m],a:i.a})),
    retParams:{curExp:+document.getElementById('r_curExp').value,inf:+document.getElementById('r_inf').value,
      retAge:+document.getElementById('r_retAge').value,endAge:+document.getElementById('r_endAge').value,
      retRtn:+document.getElementById('r_retRtn').value,accum:+document.getElementById('r_accum').value},
    rfParams:{fund:+document.getElementById('rf_fund').value,exp1:+document.getElementById('rf_exp1').value,
      rtn:+document.getElementById('rf_rtn').value,inf:+document.getElementById('rf_inf').value,
      startAge:+document.getElementById('rf_startAge').value,years:+document.getElementById('rf_years').value}
  };
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);
  a.download='FA_Plan_'+APP.client.name.replace(/\s/g,'_')+'_'+new Date().toISOString().slice(0,10)+'.json';
  a.click();URL.revokeObjectURL(a.href);
}
function importData(ev){
  const file=ev.target.files[0];if(!file)return;
  const reader=new FileReader();
  reader.onload=function(e){
    try{
      const d=JSON.parse(e.target.result);
      if(d.client)Object.assign(APP.client,d.client);
      if(d.assum)Object.assign(APP.assum,d.assum);
      if(d.bsAssets){bsAssets.length=0;d.bsAssets.forEach(i=>bsAssets.push(i));}
      if(d.bsLiabs){bsLiabs.length=0;d.bsLiabs.forEach(i=>bsLiabs.push(i));}
      if(d.cfItems){cfItems.length=0;d.cfItems.forEach(i=>cfItems.push(i));}
      if(d.retParams){
        document.getElementById('r_curExp').value=d.retParams.curExp;
        document.getElementById('r_inf').value=d.retParams.inf;
        document.getElementById('r_retAge').value=d.retParams.retAge;
        document.getElementById('r_endAge').value=d.retParams.endAge;
        document.getElementById('r_retRtn').value=d.retParams.retRtn;
        document.getElementById('r_accum').value=d.retParams.accum;
      }
      if(d.rfParams){
        document.getElementById('rf_fund').value=d.rfParams.fund;
        document.getElementById('rf_exp1').value=d.rfParams.exp1;
        document.getElementById('rf_rtn').value=d.rfParams.rtn;
        document.getElementById('rf_inf').value=d.rfParams.inf;
        document.getElementById('rf_startAge').value=d.rfParams.startAge;
        document.getElementById('rf_years').value=d.rfParams.years;
      }
      // Sync assumption inputs
      document.getElementById('a_retAge').value=APP.assum.retAge;
      document.getElementById('a_endAge').value=APP.assum.endAge;
      document.getElementById('a_incGrow').value=(APP.assum.incGrow*100).toFixed(1);
      document.getElementById('a_infGen').value=(APP.assum.infGen*100).toFixed(1);
      document.getElementById('a_infMed').value=(APP.assum.infMed*100).toFixed(1);
      document.getElementById('a_retReturn').value=(APP.assum.retReturn*100).toFixed(1);
      document.getElementById('a_pvdReturn').value=(APP.assum.pvdReturn*100).toFixed(1);
      document.getElementById('a_addInvest').value=APP.assum.addInvest;
      initAll();
      alert('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    }catch(err){alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: '+err.message);}
  };
  reader.readAsText(file);ev.target.value='';
}

// ===== PRINT =====
function printCurrentTab(){
  const active=document.querySelector('.section.active');
  if(!active)return;
  const clientInfo=APP.client.name+' | ‡∏≠‡∏≤‡∏¢‡∏∏ '+APP.client.age+' ‡∏õ‡∏µ | '+APP.client.job+' | '+new Date().toLocaleDateString('th-TH');
  document.querySelectorAll('.print-hdr p').forEach(p=>p.textContent=clientInfo);
  // Show all tab-c in cashflow for printing
  const tabCs=document.querySelectorAll('#sec-cashflow .tab-c');
  tabCs.forEach(t=>t.style.display='block');
  // Mark active section for print
  active.classList.add('print-active');
  window.print();
  // Restore
  active.classList.remove('print-active');
  // Restore cashflow tabs
  const activeTab=document.querySelector('#sec-cashflow .tab-b.active');
  tabCs.forEach(t=>t.style.display='none');
  if(activeTab)document.getElementById(activeTab.dataset.t).style.display='block';
}
</script>
<script>
// ===== CASH FLOW DATA =====
const MO=['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'];
const cfItems=[
  {cat:'inc',grp:'‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô',name:'‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á',m:[42000,42000,42000,42000,42000,42000,42000,42000,42000,42000,42000,42000],a:0},
  {cat:'inc',grp:'‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô',name:'‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:0},
  {cat:'inc',grp:'‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô',name:'‡πÇ‡∏ö‡∏ô‡∏±‡∏™',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:0},
  {cat:'inc',grp:'‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå',name:'‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢/‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏ô‡∏ú‡∏•',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:0},
  {cat:'inc',grp:'‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå',name:'‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏≤‡∏¢‡∏õ‡∏µ)',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:42000},
  {cat:'save',grp:'‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏ó‡∏∏‡∏ô',name:'‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ä‡∏µ‡∏û',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:0},
  {cat:'save',grp:'‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏ó‡∏∏‡∏ô',name:'‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:0},
  {cat:'fix',grp:'‡∏†‡∏≤‡∏©‡∏µ',name:'‡∏†‡∏≤‡∏©‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏±‡∏Å ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢',m:[1267,1267,1267,1267,1267,1267,1267,1267,1267,1267,1267,1267],a:0},
  {cat:'fix',grp:'',name:'‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ó‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°',m:[750,750,750,750,750,750,750,750,750,750,750,750],a:0},
  {cat:'fix',grp:'‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ',name:'‡∏ú‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô/‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:0},
  {cat:'fix',grp:'‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ',name:'‡∏ú‡πà‡∏≠‡∏ô‡∏£‡∏ñ',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:0},
  {cat:'fix',grp:'‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô',name:'‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:30000},
  {cat:'fix',grp:'‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô',name:'‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ß‡∏¥‡∏ô‡∏≤‡∏®‡∏†‡∏±‡∏¢',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:12000},
  {cat:'var',grp:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß',name:'‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô)',m:[9000,9000,9000,9000,9000,9000,9000,9000,9000,9000,9000,9000],a:0},
  {cat:'var',grp:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß',name:'‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠',m:[500,500,500,500,500,500,500,500,500,500,500,500],a:0},
  {cat:'var',grp:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß',name:'‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏≠‡∏≤‡∏á',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:20000},
  {cat:'var',grp:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß',name:'‡∏™‡∏±‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏≤‡∏£',m:[7000,7000,7000,7000,7000,7000,7000,7000,7000,7000,7000,7000],a:0},
  {cat:'var',grp:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß',name:'‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏ô‡πÄ‡∏≠‡∏á',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:0},
  {cat:'var',grp:'‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á',name:'‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô/‡∏ó‡∏≤‡∏á‡∏î‡πà‡∏ß‡∏ô/‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£',m:[5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000,5000],a:0},
  {cat:'var',grp:'‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á',name:'‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå',m:[0,0,0,8000,0,0,0,8000,0,0,0,8000],a:0},
  {cat:'var',grp:'‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß',name:'‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï/‡πÄ‡∏Ñ‡πÄ‡∏ö‡∏¥‡∏•TV',m:[1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000],a:0},
  {cat:'var',grp:'‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß',name:'‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô',m:[2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000],a:0},
  {cat:'var',grp:'‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß',name:'‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ö‡∏¥‡∏î‡∏≤‡∏°‡∏≤‡∏£‡∏î‡∏≤',m:[10000,10000,0,0,0,0,0,0,0,0,0,0],a:0},
  {cat:'var',grp:'‡∏™‡∏±‡∏á‡∏Ñ‡∏°/‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç',name:'‡∏†‡∏≤‡∏©‡∏µ‡∏™‡∏±‡∏á‡∏Ñ‡∏°',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:8000},
  {cat:'var',grp:'‡∏™‡∏±‡∏á‡∏Ñ‡∏°/‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç',name:'‡∏ó‡∏≥‡∏ö‡∏∏‡∏ç',m:[0,0,0,0,0,0,0,0,0,0,0,0],a:8000}
];
const invRates=[0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.04,0.04,0.05,0.05,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02];

// ===== RENDER PROFILE & ASSUMPTIONS =====
function renderProfile(){
  const c=APP.client;
  document.getElementById('profileDL').innerHTML=
    '<dt>‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏™‡∏Å‡∏∏‡∏•</dt><dd>'+c.name+'</dd><dt>‡πÄ‡∏û‡∏®</dt><dd>'+c.gender+'</dd><dt>‡∏≠‡∏≤‡∏¢‡∏∏</dt><dd>'+c.age+' ‡∏õ‡∏µ</dd><dt>‡∏™‡∏ñ‡∏≤‡∏ô‡∏†‡∏≤‡∏û</dt><dd>'+c.status+'</dd><dt>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</dt><dd>'+c.job+' ‚Äî '+c.company+'</dd><dt>‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</dt><dd>'+APP.assum.retAge+' ‡∏õ‡∏µ (‡∏≠‡∏µ‡∏Å '+(APP.assum.retAge-c.age)+' ‡∏õ‡∏µ)</dd><dt>‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</dt><dd>'+APP.assum.endAge+' ‡∏õ‡∏µ</dd>';
}
function renderAssumptions(){
  const a=APP.assum;
  document.getElementById('assumDL').innerHTML=
    '<dt>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô</dt><dd class="mono">'+(a.incGrow*100).toFixed(1)+'% /‡∏õ‡∏µ</dd><dt>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</dt><dd class="mono">'+(a.infGen*100).toFixed(1)+'% /‡∏õ‡∏µ</dd><dt>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤</dt><dd class="mono">'+(a.infMed*100).toFixed(1)+'% /‡∏õ‡∏µ</dd><dt>‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</dt><dd class="mono">'+(a.retReturn*100).toFixed(1)+'% /‡∏õ‡∏µ</dd><dt>‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á</dt><dd class="mono">'+(a.pvdReturn*100).toFixed(1)+'% /‡∏õ‡∏µ</dd><dt>‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏õ‡∏µ</dt><dd class="mono">'+F(a.addInvest)+' ‡∏ö‡∏≤‡∏ó</dd>';
}
function renderDashKPI(){
  const totA=bsAssets.reduce((s,i)=>s+i.val,0);
  const totL=bsLiabs.reduce((s,i)=>s+i.val,0);
  const nw=totA-totL;
  document.getElementById('dashKPI').innerHTML=
    '<div class="kpi"><div class="lb">‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏°</div><div class="vl" style="color:var(--ac)">'+F(totA)+'</div><div class="ch" style="color:var(--tx3)">‡∏ö‡∏≤‡∏ó</div></div>'+
    '<div class="kpi"><div class="lb">‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏ß‡∏°</div><div class="vl" style="color:var(--dng)">'+F(totL)+'</div><div class="ch" style="color:var(--tx3)">'+(totA>0?P(totL/totA):'0%')+'</div></div>'+
    '<div class="kpi"><div class="lb">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</div><div class="vl" style="color:var(--ac3)">'+F(nw)+'</div><div class="ch good">'+(totA>0?P(nw/totA):'0%')+'</div></div>'+
    '<div class="kpi"><div class="lb">‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</div><div class="vl" style="color:var(--gold)" id="dashRetFund">‚Äî</div><div class="ch warn" id="dashRetGap"></div></div>';
}
function renderDashCharts(){
  const names=bsAssets.filter(i=>i.val>0).map(i=>i.name);
  const vals=bsAssets.filter(i=>i.val>0).map(i=>i.val);
  const totA=bsAssets.reduce((s,i)=>s+i.val,0);const totL=bsLiabs.reduce((s,i)=>s+i.val,0);
  uChart('cAssetPie','doughnut',{labels:names,datasets:[{data:vals,backgroundColor:['#38bdf8','#818cf8','#34d399','#fbbf24','#a78bfa','#fb923c'],borderWidth:0}]},{cutout:'65%',plugins:{legend:{position:'bottom',labels:{padding:16,usePointStyle:true}}}});
  uChart('cNetWorth','bar',{labels:['‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå','‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô','‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥'],datasets:[{data:[totA,totL,totA-totL],backgroundColor:['#38bdf8','#f87171','#34d399'],borderRadius:6,barThickness:40}]},{indexAxis:'y',plugins:{legend:{display:false}},scales:{x:{ticks:{callback:v=>F(v)}},y:{grid:{display:false}}}});
}

// ===== RATIO =====
function renderRatioSnap(){
  const totA=bsAssets.reduce((s,i)=>s+i.val,0);const totL=bsLiabs.reduce((s,i)=>s+i.val,0);const nw=totA-totL;
  const liq=bsAssets.filter(i=>i.grp==='‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á').reduce((s,i)=>s+i.val,0);
  const stDebt=bsLiabs.filter(i=>i.grp==='‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô').reduce((s,i)=>s+i.val,0);
  const tInc=cfItems.filter(i=>i.cat==='inc').reduce((s,i)=>s+i.m.reduce((a,v)=>a+v,0)+i.a,0);
  const tExp=cfItems.filter(i=>i.cat!=='inc').reduce((s,i)=>s+i.m.reduce((a,v)=>a+v,0)+i.a,0);
  const tNet=tInc-tExp;
  const liqR=stDebt>0?(liq/stDebt).toFixed(2):'‚àû';
  const basicLiq=tExp>0?((liq/(tExp/12)).toFixed(2)):'‚àû';
  const liqNW=nw>0?P(liq/nw):'0%';
  const debtR=totA>0?P(totL/totA):'0%';
  const saveR=tInc>0?P(tNet/tInc):'0%';
  const R=[
    {n:'‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á',v:liqR+' ‡πÄ‡∏ó‡πà‡∏≤',b:'‚â•1',ok:stDebt===0||liq/stDebt>=1},
    {n:'‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô',v:basicLiq+' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',b:'3-6',ok:tExp===0||liq/(tExp/12)>=3},
    {n:'‡∏Ñ‡∏•‡πà‡∏≠‡∏á/‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á',v:liqNW,b:'15-20%',ok:nw>0&&liq/nw>=0.15},
    {n:'‡∏´‡∏ô‡∏µ‡πâ/‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå',v:debtR,b:'‚â§50%',ok:totA===0||totL/totA<=0.5},
    {n:'‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ/‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ',v:'0%',b:'‚â§35%',ok:true},
    {n:'‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°',v:saveR,b:'‚â•10%',ok:tInc>0&&tNet/tInc>=0.1},
    {n:'‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô',v:'0%',b:'‚â•50%',ok:false}
  ];
  document.getElementById('ratioSnap').innerHTML=R.map(r=>'<div class="kpi"><div class="lb">'+r.n+'</div><div class="vl" style="font-size:calc(var(--fs) + 2px)">'+r.v+'</div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px"><span style="font-size:calc(var(--fs) - 4px);color:var(--tx3)">‡πÄ‡∏Å‡∏ì‡∏ë‡πå: '+r.b+'</span><span class="st '+(r.ok?'st-ok':'st-no')+'">'+(r.ok?'‚úÖ':'‚ö†Ô∏è')+'</span></div></div>').join('');
}
function renderRatioTable(){
  const totA=bsAssets.reduce((s,i)=>s+i.val,0);const totL=bsLiabs.reduce((s,i)=>s+i.val,0);const nw=totA-totL;
  const liq=bsAssets.filter(i=>i.grp==='‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á').reduce((s,i)=>s+i.val,0);
  const stDebt=bsLiabs.filter(i=>i.grp==='‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô').reduce((s,i)=>s+i.val,0);
  const tInc=cfItems.filter(i=>i.cat==='inc').reduce((s,i)=>s+i.m.reduce((a,v)=>a+v,0)+i.a,0);
  const tExp=cfItems.filter(i=>i.cat!=='inc').reduce((s,i)=>s+i.m.reduce((a,v)=>a+v,0)+i.a,0);
  const tNet=tInc-tExp;const expPM=tExp/12;
  const liqR=stDebt>0?(liq/stDebt):999;const basicLiq=tExp>0?(liq/expPM):999;
  const invAsset=bsAssets.filter(i=>i.grp==='‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏•‡∏á‡∏ó‡∏∏‡∏ô').reduce((s,i)=>s+i.val,0);
  // Build detailed ratio sections matching Excel format
  let h='';
  // Section 1: Liquidity
  h+='<h3 style="font-size:calc(var(--fs) - 1px);font-weight:700;color:var(--ac);margin:16px 0 8px;padding:6px 0;border-bottom:2px solid var(--ac)">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á</h3><table><tbody>';
  // 1.1
  const liqVal=stDebt>0?liqR:999;const liqOk=liqVal>=1;
  h+=ratioRow('‚Ä¢ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á',(liqVal>100?'‚àû':liqVal.toFixed(2))+' ‡πÄ‡∏ó‡πà‡∏≤','‚â• 1 ‡πÄ‡∏ó‡πà‡∏≤',liqOk,liqOk?'‚úÖ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠':'‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠');
  h+=subRow('‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á',liq);
  h+=subRow('‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô',stDebt);
  h+=formulaRow('‡∏™‡∏π‡∏ï‡∏£: ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á √∑ ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô = '+F(liq)+' √∑ '+F(stDebt));
  // 1.2
  const blVal=tExp>0?basicLiq:999;const blOk=blVal>=3;
  h+=ratioRow('‚Ä¢ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô',(blVal>100?'‚àû':blVal.toFixed(2))+' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô','3-6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',blOk,blOk?(blVal>6?'‚úÖ ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå':'‚úÖ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠'):'‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠');
  h+=subRow('‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á',liq);
  h+=subRow('‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',Math.round(expPM));
  h+=formulaRow('‡∏™‡∏π‡∏ï‡∏£: ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á √∑ ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô = '+F(liq)+' √∑ '+F(Math.round(expPM)));
  // 1.3
  const lnwVal=nw>0?liq/nw:0;const lnwOk=lnwVal>=0.15;
  h+=ratioRow('‚Ä¢ ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á √∑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥',P(lnwVal),'15-20%',lnwOk,lnwOk?'‚úÖ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠':'‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠');
  h+=subRow('‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á',liq);
  h+=subRow('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥',nw);
  h+=formulaRow('‡∏™‡∏π‡∏ï‡∏£: ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á √∑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ = '+F(liq)+' √∑ '+F(nw));
  h+='</tbody></table>';
  // Section 2: Debt
  h+='<h3 style="font-size:calc(var(--fs) - 1px);font-weight:700;color:var(--dng);margin:20px 0 8px;padding:6px 0;border-bottom:2px solid var(--dng)">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô</h3><table><tbody>';
  const daVal=totA>0?totL/totA:0;const daOk=daVal<=0.5;
  h+=ratioRow('‚Ä¢ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå',P(daVal),'‚â§ 50%',daOk,daOk?'‚úÖ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠':'‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå');
  h+=subRow('‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏ß‡∏°',totL);
  h+=subRow('‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏°',totA);
  h+=formulaRow('‡∏™‡∏π‡∏ï‡∏£: ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏ß‡∏° √∑ ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏£‡∏ß‡∏° = '+F(totL)+' √∑ '+F(totA));
  const drVal=tInc>0?0/tInc:0;
  h+=ratioRow('‚Ä¢ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ','0%','‚â§ 35%',true,'‚úÖ ‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‚Äî ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏£‡∏∞‡∏ú‡πà‡∏≠‡∏ô');
  h+=subRow('‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',0);
  h+=subRow('‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡∏õ‡∏µ',tInc);
  h+=formulaRow('‡∏™‡∏π‡∏ï‡∏£: ‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ/‡∏õ‡∏µ √∑ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°/‡∏õ‡∏µ = 0 √∑ '+F(tInc));
  h+='</tbody></table>';
  // Section 3: Saving & Investment
  h+='<h3 style="font-size:calc(var(--fs) - 1px);font-weight:700;color:var(--ac3);margin:20px 0 8px;padding:6px 0;border-bottom:2px solid var(--ac3)">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô</h3><table><tbody>';
  const srVal=tInc>0?tNet/tInc:0;const srOk=srVal>=0.1;
  h+=ratioRow('‚Ä¢ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°',P(srVal),'‚â• 10%',srOk,srOk?'‚úÖ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠':'‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠');
  h+=subRow('‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏° (‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢)',tNet);
  h+=subRow('‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°',tInc);
  h+=formulaRow('‡∏™‡∏π‡∏ï‡∏£: ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏° √∑ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏° = '+F(tNet)+' √∑ '+F(tInc));
  const ivVal=nw>0?invAsset/nw:0;const ivOk=ivVal>=0.5;
  h+=ratioRow('‚Ä¢ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô',P(ivVal),'‚â• 50%',ivOk,ivOk?'‚úÖ ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠':'‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠');
  h+=subRow('‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏•‡∏á‡∏ó‡∏∏‡∏ô',invAsset);
  h+=subRow('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥',nw);
  h+=formulaRow('‡∏™‡∏π‡∏ï‡∏£: ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏•‡∏á‡∏ó‡∏∏‡∏ô √∑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ = '+F(invAsset)+' √∑ '+F(nw));
  h+='</tbody></table>';
  document.getElementById('ratioDetail').innerHTML=h;
  // Chart
  const cv=[liqVal>20?20:liqVal,blVal>20?20:blVal,lnwVal*100,daVal*100,0,srVal*100,ivVal*100];
  uChart('cRatioBar','bar',{labels:['‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á(‡πÄ‡∏ó‡πà‡∏≤)','‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô(‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)','‡∏Ñ‡∏•‡πà‡∏≠‡∏á/‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á(%)','‡∏´‡∏ô‡∏µ‡πâ/‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå(%)','‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ(%)','‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°(%)','‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô(%)'],datasets:[{label:'‡∏Ñ‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á',data:cv,backgroundColor:'#38bdf8',borderRadius:3},{label:'‡πÄ‡∏Å‡∏ì‡∏ë‡πå',data:[1,6,15,50,35,10,50],backgroundColor:'rgba(251,191,36,.35)',borderRadius:3}]},{scales:{y:{grid:{color:'rgba(100,116,139,.15)'}},x:{grid:{display:false}}}});
}
function ratioRow(name,val,bench,ok,note){
  return '<tr style="background:var(--hovbg)"><td style="font-weight:700;padding:12px 14px">'+name+'</td><td class="tr num" style="font-weight:800;font-size:calc(var(--fs) + 1px);color:'+(ok?'var(--ac3)':'var(--dng)')+'">'+val+'</td><td class="tr num" style="color:var(--tx3)">'+bench+'</td><td class="tc"><span class="st '+(ok?'st-ok':'st-no')+'">'+note+'</span></td></tr>';
}
function subRow(label,val){
  return '<tr><td style="padding-left:32px;font-size:calc(var(--fs) - 2px);color:var(--tx2)">- '+label+'</td><td class="tr num" style="color:var(--tx)">'+F(val)+'</td><td></td><td></td></tr>';
}
function formulaRow(text){
  return '<tr><td colspan=4 style="padding-left:32px;font-size:calc(var(--fs) - 3px);color:var(--tx3);font-style:italic;border-bottom:1px solid var(--cb);padding-bottom:12px;margin-bottom:6px">üìê '+text+'</td></tr>';
}

// ===== CASH FLOW =====
function cfTotal(item){return item.m.reduce((a,v)=>a+v,0)+item.a;}
function addCFRow(){
  const cat=prompt('‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:\ninc = ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö\nfix = ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà\nvar = ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏õ‡∏£‡∏ú‡∏±‡∏ô\nsave = ‡∏≠‡∏≠‡∏°/‡∏•‡∏á‡∏ó‡∏∏‡∏ô','var');if(!cat)return;
  const name=prompt('‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:');if(!name)return;
  cfItems.push({cat,grp:'‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°',name,m:[0,0,0,0,0,0,0,0,0,0,0,0],a:0});renderCashFlow();
}
function removeCFRow(i){if(confirm('‡∏•‡∏ö "'+cfItems[i].name+'" ?')){cfItems.splice(i,1);renderCashFlow();}}
function cfChanged(){
  cfItems.forEach((item,i)=>{
    for(let m=0;m<12;m++){const el=document.getElementById('cf_'+i+'_'+m);if(el)item.m[m]=+el.value;}
    const el2=document.getElementById('cf_'+i+'_a');if(el2)item.a=+el2.value;
    const tot=document.getElementById('cf_tot_'+i);if(tot)tot.textContent=F(cfTotal(item));
  });
  renderCFSummary();renderDashKPI();renderRatioSnap();renderRatioTable();renderInvestment();
}
function renderCashFlow(){
  let h='<thead><tr><th style="min-width:200px">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>';
  MO.forEach(m=>{h+='<th class="tr">'+m+'</th>';});
  h+='<th class="tr">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</th><th class="tr" style="color:var(--ac)">‡∏£‡∏ß‡∏°</th><th></th></tr></thead><tbody>';
  const catL={inc:'‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏£‡∏±‡∏ö',save:'‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏ó‡∏∏‡∏ô',fix:'‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà',var:'‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏õ‡∏£‡∏ú‡∏±‡∏ô'};
  const catC={inc:'cf-cat-inc',save:'cf-cat-fix',fix:'cf-cat-exp',var:'cf-cat-exp'};
  let lastCat='',lastGrp='';
  cfItems.forEach((item,i)=>{
    if(item.cat!==lastCat){lastCat=item.cat;lastGrp='';h+='<tr><td colspan="15" class="cf-cat '+catC[item.cat]+'">'+catL[item.cat]+'</td></tr>';}
    if(item.grp&&item.grp!==lastGrp){lastGrp=item.grp;h+='<tr><td colspan="15" style="padding-left:18px;font-weight:600;font-size:calc(var(--fs) - 3px);color:var(--tx2)">‚Ä¢ '+item.grp+'</td></tr>';}
    h+='<tr><td style="padding-left:32px;font-size:calc(var(--fs) - 2px)">'+item.name+'</td>';
    for(let m=0;m<12;m++){h+='<td class="tr"><input class="cf-input" id="cf_'+i+'_'+m+'" type="number" value="'+item.m[m]+'" onchange="cfChanged()"></td>';}
    h+='<td class="tr"><input class="cf-input" id="cf_'+i+'_a" type="number" value="'+item.a+'" onchange="cfChanged()"></td>';
    h+='<td class="tr num" style="font-weight:600" id="cf_tot_'+i+'">'+F(cfTotal(item))+'</td>';
    h+='<td><button style="color:var(--dng);background:none;border:none;cursor:pointer;font-size:calc(var(--fs))" onclick="removeCFRow('+i+')" title="‡∏•‡∏ö">‚úï</button></td></tr>';
  });
  h+='</tbody>';document.getElementById('tblCF').innerHTML=h;renderCFSummary();
}
function renderCFSummary(){
  const incM=new Array(12).fill(0),expM=new Array(12).fill(0);let incA=0,expA=0;
  cfItems.forEach(item=>{const isInc=item.cat==='inc';for(let m=0;m<12;m++){if(isInc)incM[m]+=item.m[m];else expM[m]+=item.m[m];}if(isInc)incA+=item.a;else expA+=item.a;});
  const tInc=incM.reduce((a,v)=>a+v,0)+incA,tExp=expM.reduce((a,v)=>a+v,0)+expA,tNet=tInc-tExp,sr=tInc>0?tNet/tInc:0;
  document.getElementById('cfKPI').innerHTML=
    '<div class="kpi"><div class="lb">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°/‡∏õ‡∏µ</div><div class="vl pos">'+F(tInc)+'</div></div>'+
    '<div class="kpi"><div class="lb">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°/‡∏õ‡∏µ</div><div class="vl neg">'+F(tExp)+'</div></div>'+
    '<div class="kpi"><div class="lb">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥/‡∏õ‡∏µ</div><div class="vl '+(tNet>=0?'pos':'neg')+'">'+F(tNet)+'</div></div>'+
    '<div class="kpi"><div class="lb">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</div><div class="vl" style="color:'+(sr>=0.1?'var(--ac3)':'var(--dng)')+'">'+P(sr)+'</div><div class="ch '+(sr>=0.1?'good':'bad')+'">‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‚â•10% '+(sr>=0.1?'‚úÖ':'‚ö†Ô∏è')+'</div></div>';
  const cats={};cfItems.filter(i=>i.cat!=='inc').forEach(item=>{const g=item.grp||'‡∏≠‡∏∑‡πà‡∏ô‡πÜ';if(!cats[g])cats[g]=0;cats[g]+=cfTotal(item);});
  let aH='<div class="g2"><div><h3 style="font-size:calc(var(--fs) - 1px);color:var(--ac3);margin-bottom:12px">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h3><table><tbody>';
  cfItems.filter(i=>i.cat==='inc').forEach(item=>{const t=cfTotal(item);if(t>0)aH+='<tr><td>'+item.name+'</td><td class="tr num">'+F(t)+'</td><td class="tr num">'+P(t/tInc)+'</td></tr>';});
  aH+='<tr style="font-weight:700;border-top:2px solid var(--ac3)"><td>‡∏£‡∏ß‡∏°</td><td class="tr num">'+F(tInc)+'</td><td class="tr num">100%</td></tr></tbody></table></div>';
  aH+='<div><h3 style="font-size:calc(var(--fs) - 1px);color:var(--dng);margin-bottom:12px">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3><table><tbody>';
  Object.entries(cats).forEach(([k,v])=>{if(v>0)aH+='<tr><td>'+k+'</td><td class="tr num">'+F(v)+'</td><td class="tr num">'+(tExp>0?P(v/tExp):'0%')+'</td></tr>';});
  aH+='<tr style="font-weight:700;border-top:2px solid var(--dng)"><td>‡∏£‡∏ß‡∏°</td><td class="tr num">'+F(tExp)+'</td><td class="tr num">100%</td></tr></tbody></table></div></div>';
  document.getElementById('cfAnnual').innerHTML=aH;
  const netM=incM.map((v,i)=>v-expM[i]);const cumN=[];netM.reduce((a,v,i)=>{cumN[i]=a+v;return cumN[i]},0);
  uChart('cCFBar','bar',{labels:MO,datasets:[{label:'‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö',data:incM,backgroundColor:'#34d399',borderRadius:3},{label:'‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢',data:expM,backgroundColor:'#f87171',borderRadius:3}]},{scales:{y:{ticks:{callback:v=>F(v)}},x:{grid:{display:false}}}});
  const cK=Object.keys(cats).filter(k=>cats[k]>0),cV=cK.map(k=>cats[k]);
  uChart('cExpPie','doughnut',{labels:cK,datasets:[{data:cV,backgroundColor:['#38bdf8','#818cf8','#fbbf24','#f87171','#34d399','#a78bfa','#fb923c','#f472b6'],borderWidth:0}]},{cutout:'55%',plugins:{legend:{position:'right',labels:{padding:10,usePointStyle:true,font:{size:12}}}}});
  uChart('cCumCF','line',{labels:MO,datasets:[{label:'‡∏™‡∏∞‡∏™‡∏°',data:cumN,borderColor:'#38bdf8',backgroundColor:'rgba(56,189,248,.1)',fill:true,tension:.3,pointRadius:4},{label:'‡∏™‡∏∏‡∏ó‡∏ò‡∏¥/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',data:netM,borderColor:'#34d399',tension:.3,pointRadius:4}]},{scales:{y:{ticks:{callback:v=>F(v)}},x:{grid:{display:false}}}});
}
</script>
<script>
// ===== PULL EXPENSE FROM CASHFLOW =====
function pullExpFromCF(){
  const tExp=cfItems.filter(i=>i.cat!=='inc').reduce((s,i)=>s+i.m.reduce((a,v)=>a+v,0)+i.a,0);
  document.getElementById('r_curExp').value=tExp;
  recalcRetirement();
}

// ===== RETIREMENT (Excel formulas) =====
function calcRetFundNeeded(curExp,infRate,retReturn,yearsToRetire,retDuration){
  const exp1=curExp*Math.pow(1+infRate,yearsToRetire);
  function sim(fund){
    let bal=fund,exp=exp1;
    for(let y=0;y<retDuration;y++){
      const r=y===0?0:retReturn;
      bal=bal*(1+r)-exp;
      if(y===0)exp=exp1*(1+infRate);else exp=exp*(1+infRate);
    }
    return bal;
  }
  let lo=0,hi=curExp*600;
  for(let i=0;i<120;i++){const mid=(lo+hi)/2;if(sim(mid)>0)hi=mid;else lo=mid;}
  return{fundNeeded:Math.round((lo+hi)/2),expAtRetire:Math.round(exp1)};
}
function recalcRetirement(){
  const curExp=+document.getElementById('r_curExp').value;
  const infRate=+document.getElementById('r_inf').value/100;
  const retAge=+document.getElementById('r_retAge').value;
  const endAge=+document.getElementById('r_endAge').value;
  const retRtn=+document.getElementById('r_retRtn').value/100;
  const accum=+document.getElementById('r_accum').value;
  const age=APP.client.age;const yrs=retAge-age;const dur=endAge-retAge;
  const res=calcRetFundNeeded(curExp,infRate,retRtn,yrs,dur);
  const gap=res.fundNeeded-accum;
  document.getElementById('retKPI').innerHTML=
    '<div class="kpi"><div class="lb">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</div><div class="vl" style="color:var(--gold)">'+FM(res.fundNeeded)+'</div></div>'+
    '<div class="kpi"><div class="lb">‡πÅ‡∏´‡∏•‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏° ‡∏ì ‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</div><div class="vl" style="color:var(--ac)">'+FM(accum)+'</div></div>'+
    '<div class="kpi"><div class="lb">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°</div><div class="vl neg">'+FM(gap)+'</div></div>'+
    '<div class="kpi"><div class="lb">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</div><div class="vl" style="color:var(--ac2)">'+yrs+' ‡∏õ‡∏µ</div><div class="ch" style="color:var(--tx3)">‡∏≠‡∏≤‡∏¢‡∏∏ '+age+'‚Üí'+retAge+'</div></div>';
  document.getElementById('retSummary').innerHTML=
    '<div><h3 style="font-size:calc(var(--fs) - 1px);color:var(--gold);margin-bottom:12px">‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</h3><table><tbody>'+
    '<tr><td>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô/‡∏õ‡∏µ</td><td class="tr num">'+F(curExp)+' ‡∏ö‡∏≤‡∏ó</td></tr>'+
    '<tr><td>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì (‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠ '+(infRate*100).toFixed(1)+'%)</td><td class="tr num">'+F(res.expAtRetire)+' ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ</td></tr>'+
    '<tr><td>‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì</td><td class="tr num">'+dur+' ‡∏õ‡∏µ (‡∏≠‡∏≤‡∏¢‡∏∏ '+retAge+'-'+endAge+')</td></tr>'+
    '<tr style="font-weight:700;color:var(--gold)"><td>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</td><td class="tr num">'+F(res.fundNeeded)+' ‡∏ö‡∏≤‡∏ó</td></tr></tbody></table></div>'+
    '<div><h3 style="font-size:calc(var(--fs) - 1px);color:var(--ac);margin-bottom:12px">‡πÅ‡∏´‡∏•‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏°</h3><table><tbody>'+
    '<tr><td>‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏°‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏†‡∏≤‡∏Ñ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à</td><td class="tr num">'+F(accum)+' ‡∏ö‡∏≤‡∏ó</td></tr>'+
    '<tr style="font-weight:700;color:var(--dng)"><td>‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°</td><td class="tr num">'+F(gap)+' ‡∏ö‡∏≤‡∏ó</td></tr></tbody></table></div>';
  document.getElementById('rf_fund').value=res.fundNeeded;
  document.getElementById('rf_exp1').value=res.expAtRetire;
  document.getElementById('rf_startAge').value=retAge;
  document.getElementById('rf_years').value=dur;
  const inv=APP.assum.addInvest;
  document.getElementById('retInvLbl').textContent=F(inv)+' ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ';
  const lb=[],vl=[],ci=[];let pv=0;
  for(let y=0;y<yrs;y++){const r=invRates[y]||0.02;pv=pv*(1+r)+inv;lb.push(2567+y);vl.push(Math.round(pv));ci.push((y+1)*inv);}
  uChart('cRetGrow','line',{labels:lb,datasets:[{label:'‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏û‡∏≠‡∏£‡πå‡∏ï',data:vl,borderColor:'#34d399',backgroundColor:'rgba(52,211,153,.1)',fill:true,tension:.3,pointRadius:1},{label:'‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏∞‡∏™‡∏°',data:ci,borderColor:'#818cf8',borderDash:[5,3],tension:.3,pointRadius:0}]},{scales:{y:{ticks:{callback:v=>FM(v)}},x:{grid:{display:false},ticks:{maxTicksLimit:16}}}});
  const df=document.getElementById('dashRetFund');if(df)df.textContent=FM(res.fundNeeded);
  const dg=document.getElementById('dashRetGap');if(dg)dg.textContent='‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° '+FM(gap);
  recalcRetFund();
}

// ===== RETIREMENT FUND DRAWDOWN (Excel: 5.‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡∏û‡∏∂‡∏á‡∏°‡∏µ_1) =====
function recalcRetFund(){
  const fund=+document.getElementById('rf_fund').value;
  const exp1=+document.getElementById('rf_exp1').value;
  const rtn=+document.getElementById('rf_rtn').value/100;
  const inf=+document.getElementById('rf_inf').value/100;
  const startAge=+document.getElementById('rf_startAge').value;
  const years=+document.getElementById('rf_years').value;
  document.getElementById('rfBanner').innerHTML=
    '<div style="display:flex;align-items:center;gap:16px"><div style="font-size:38px">üè¶</div><div><div style="font-size:calc(var(--fs) - 2px);color:var(--tx3)">‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡∏û‡∏∂‡∏á‡∏°‡∏µ</div><div style="font-size:calc(var(--fs) + 12px);font-weight:800;color:var(--gold)">‡∏ø '+F(fund)+'</div><div style="font-size:calc(var(--fs) - 4px);color:var(--tx3)">‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô '+(rtn*100).toFixed(1)+'% ¬∑ ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠ '+(inf*100).toFixed(1)+'%</div></div></div>';
  const data=[];let bal=fund,curExp=exp1;
  for(let y=0;y<years;y++){
    const r=y===0?0:rtn;const fpr=bal*(1+r);
    const expAdj=y===0?curExp:curExp*(1+inf);
    if(y>0)curExp=expAdj;
    const remain=fpr-(y===0?curExp:expAdj);
    data.push({yr:y+1,age:startAge+y,fs:Math.round(bal),r,fpr:Math.round(fpr),exp:Math.round(y===0?curExp:expAdj),g:y===0?0:inf,rem:Math.round(remain)});
    bal=remain;if(y===0)curExp=exp1;
  }
  const dep=data.find(d=>d.rem<0);
  let h='<thead><tr><th>‡∏õ‡∏µ‡∏ó‡∏µ‡πà</th><th>‡∏≠‡∏≤‡∏¢‡∏∏</th><th class="tr">‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ï‡πâ‡∏ô‡∏õ‡∏µ</th><th class="tr">E(R)%</th><th class="tr">‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô+‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢</th><th class="tr">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢/‡∏õ‡∏µ</th><th class="tr">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠%</th><th class="tr">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th></tr></thead><tbody>';
  data.forEach(d=>{
    const neg=d.rem<0;
    h+='<tr'+(neg?' style="background:rgba(248,113,113,.07)"':'')+'><td>'+d.yr+'</td><td>'+d.age+'</td><td class="tr num '+(d.fs<0?'neg':'')+'">'+F(d.fs)+'</td><td class="tr num">'+(d.r*100).toFixed(0)+'%</td><td class="tr num">'+F(d.fpr)+'</td><td class="tr num">'+F(d.exp)+'</td><td class="tr num">'+(d.g*100).toFixed(1)+'%</td><td class="tr num '+(neg?'neg':'pos')+'" style="font-weight:700">'+F(d.rem)+'</td></tr>';
  });
  h+='</tbody>';
  if(dep)h+='<tfoot><tr><td colspan=8 style="text-align:center;padding:16px;color:var(--dng);font-weight:700;font-size:calc(var(--fs) + 2px)">‚ö†Ô∏è ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏¢‡∏∏ '+dep.age+' ‡∏õ‡∏µ (‡∏õ‡∏µ‡∏ó‡∏µ‡πà '+dep.yr+')</td></tr></tfoot>';
  document.getElementById('tblRF').innerHTML=h;
  uChart('cRFLine','line',{labels:data.map(d=>'‡∏≠‡∏≤‡∏¢‡∏∏ '+d.age),datasets:[
    {label:'‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠',data:data.map(d=>d.rem),borderColor:'#38bdf8',backgroundColor:'rgba(56,189,248,.05)',fill:true,tension:.3,pointRadius:3,segment:{borderColor:ctx=>ctx.p1.parsed.y<0?'#f87171':'#38bdf8'}},
    {label:'‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢/‡∏õ‡∏µ',data:data.map(d=>d.exp),borderColor:'#fbbf24',borderDash:[4,4],tension:.3,pointRadius:0}
  ]},{scales:{y:{ticks:{callback:v=>FM(v)}},x:{grid:{display:false}}}});
}

// ===== INVESTMENT =====
function renderInvestment(){
  const inv=APP.assum.addInvest;const age=APP.client.age;const yrs=APP.assum.retAge-age;
  let h='<thead><tr><th>‡∏õ‡∏µ‡∏ó‡∏µ‡πà</th><th>‡∏≠‡∏≤‡∏¢‡∏∏</th><th>‡∏û.‡∏®.</th><th class="tr">‡∏•‡∏á‡∏ó‡∏∏‡∏ô/‡∏õ‡∏µ</th><th class="tr">E(R)</th><th class="tr">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏û‡∏≠‡∏£‡πå‡∏ï</th><th class="tr">‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏∞‡∏™‡∏°</th><th class="tr">‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô</th></tr></thead><tbody>';
  const lb=[],vl=[],ci=[];let pv=0;
  for(let y=0;y<yrs;y++){
    const r=invRates[y]||0.02;pv=pv*(1+r)+inv;const cum=(y+1)*inv;const pnl=Math.round(pv)-cum;
    lb.push('‡∏õ‡∏µ '+(y+1));vl.push(Math.round(pv));ci.push(cum);
    h+='<tr><td>'+(y+1)+'</td><td>'+(age+y)+'</td><td>'+(2567+y)+'</td><td class="tr num">'+F(inv)+'</td><td class="tr num">'+(r*100).toFixed(0)+'%</td><td class="tr num pos" style="font-weight:600">'+F(pv)+'</td><td class="tr num">'+F(cum)+'</td><td class="tr num '+(pnl>=0?'pos':'neg')+'">'+F(pnl)+'</td></tr>';
  }
  h+='</tbody>';document.getElementById('tblInv').innerHTML=h;
  uChart('cInvGrow','bar',{labels:lb,datasets:[{label:'‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏∞‡∏™‡∏°',data:ci,backgroundColor:'rgba(129,140,248,.4)',borderRadius:2},{label:'‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏û‡∏≠‡∏£‡πå‡∏ï',data:vl,backgroundColor:'rgba(52,211,153,.6)',borderRadius:2}]},{scales:{y:{ticks:{callback:v=>F(v)}},x:{grid:{display:false},ticks:{maxTicksLimit:16}}}});
  const tInc=cfItems.filter(i=>i.cat==='inc').reduce((s,i)=>s+i.m.reduce((a,v)=>a+v,0)+i.a,0);
  const tExp=cfItems.filter(i=>i.cat!=='inc').reduce((s,i)=>s+i.m.reduce((a,v)=>a+v,0)+i.a,0);
  const bY=[],bI=[],bE=[];
  for(let y=0;y<50;y++){
    bY.push((2569+y)+'('+(age+2+y)+')');
    bI.push((age+2+y)>=APP.assum.retAge?0:Math.round(tInc*Math.pow(1+APP.assum.incGrow,y)));
    bE.push(Math.round(tExp*Math.pow(1+APP.assum.infGen,y)));
  }
  uChart('cBudget','line',{labels:bY,datasets:[{label:'‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö',data:bI,borderColor:'#34d399',tension:.3,pointRadius:0},{label:'‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢',data:bE,borderColor:'#f87171',tension:.3,pointRadius:0}]},{scales:{y:{ticks:{callback:v=>FM(v)}},x:{grid:{display:false},ticks:{maxTicksLimit:18}}}});
}

// ===== RECALC & INIT =====
function recalcAll(){renderDashKPI();renderDashCharts();renderRatioSnap();renderRatioTable();recalcRetirement();renderInvestment();}
function initAll(){renderProfile();renderAssumptions();renderDashKPI();renderRatioSnap();renderDashCharts();renderBalanceSheet();renderCashFlow();renderRatioTable();recalcRetirement();renderInvestment();}
initAll();
</script>
</body>
</html>